# jxt-core ç»„ä»¶ README æ›´æ–°æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†å¯¹ jxt-core é¡¹ç›®ä¸­ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼ˆdomain/eventã€outboxã€eventbusï¼‰çš„ README æ–‡æ¡£æ›´æ–°ï¼Œä»¥åæ˜ æœ€æ–°çš„ä»£ç å˜æ›´å’Œåºåˆ—åŒ–åŠŸèƒ½å¢å¼ºã€‚

**æ›´æ–°æ—¥æœŸ**: 2025-10-26  
**æ›´æ–°åŸå› **: æ–°å¢ EnterpriseDomainEvent åºåˆ—åŒ–/ååºåˆ—åŒ–æµ‹è¯•ç”¨ä¾‹ï¼ˆ21 ä¸ªï¼‰ï¼Œéœ€è¦åŒæ­¥æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ”„ æ›´æ–°çš„ç»„ä»¶

### 1. domain/event ç»„ä»¶

**æ–‡ä»¶**: `jxt-core/sdk/pkg/domain/event/README.md`

#### ä¸»è¦æ›´æ–°å†…å®¹

##### âœ… æ›´æ–°åºåˆ—åŒ–ä¼˜åŠ¿è¯´æ˜
- ä» "ç»Ÿä¸€ä½¿ç”¨ encoding/json" æ›´æ–°ä¸º "ç»Ÿä¸€ä½¿ç”¨ jxtjsonï¼ˆåŸºäº jsoniterï¼‰"
- æ–°å¢æ€§èƒ½ä¼˜åŠ¿è¯´æ˜ï¼šæ¯”æ ‡å‡†åº“å¿« 2-3 å€
- æ–°å¢ä¸ encoding/json å®Œå…¨å…¼å®¹çš„è¯´æ˜

##### âœ… æ–°å¢æ€§èƒ½ç‰¹æ€§ç« èŠ‚
æ·»åŠ äº†è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡è¡¨æ ¼ï¼š

| æ“ä½œ | æ€§èƒ½æŒ‡æ ‡ | è¯´æ˜ |
|------|---------|------|
| åºåˆ—åŒ– | ~690ns/op | æ¯” encoding/json å¿« 2-3 å€ |
| ååºåˆ—åŒ– | ~1.2Î¼s/op | æ¯” encoding/json å¿« 2-3 å€ |
| å¤§ Payload | ~511Î¼s (1000 å­—æ®µ) | 51KB JSON æ•°æ® |
| å¹¶å‘å®‰å…¨ | âœ… 100 goroutines | æ— ç«æ€æ¡ä»¶ |

##### âœ… æ–°å¢æ€§èƒ½æµ‹è¯•è¯´æ˜
```bash
# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
go test -run TestEnterpriseDomainEvent_PerformanceBenchmark -v

# è¿è¡Œå¹¶å‘æµ‹è¯•
go test -run TestEnterpriseDomainEvent_ConcurrentSerialization -v
```

##### âœ… æ‰©å±•æµ‹è¯•ç« èŠ‚
- æ–°å¢å›å½’æµ‹è¯•è¿è¡Œè¯´æ˜
- æ–°å¢æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡ï¼š
  - åŸºç¡€åŠŸèƒ½æµ‹è¯•: 14 ä¸ª
  - ä¼ä¸šçº§äº‹ä»¶æµ‹è¯•: 15 ä¸ª
  - **åºåˆ—åŒ–æµ‹è¯•: 21 ä¸ªï¼ˆæ–°å¢ï¼‰**
  - é›†æˆæµ‹è¯•: 9 ä¸ª
  - Payload æµ‹è¯•: 13 ä¸ª
  - éªŒè¯æµ‹è¯•: 16 ä¸ª

##### âœ… æ›´æ–°ç‰ˆæœ¬å†å²
æ–°å¢ v1.1.0 ç‰ˆæœ¬è¯´æ˜ï¼š
- æ–°å¢ 21 ä¸ªåºåˆ—åŒ–/ååºåˆ—åŒ–æµ‹è¯•
- ç»Ÿä¸€ä½¿ç”¨ jxtjson åŒ…
- æ€§èƒ½ä¼˜åŒ–
- å®Œæ•´çš„æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•
- ä¸ encoding/json å®Œå…¨å…¼å®¹
- æ”¯æŒç‰¹æ®Šå­—ç¬¦å’Œå¤§ Payload

##### âœ… æ‰©å±•ç›¸å…³æ–‡æ¡£é“¾æ¥
æ–°å¢ä¸‰ä¸ªæ–‡æ¡£åˆ†ç±»ï¼š
1. **æ ¸å¿ƒæ–‡æ¡£**: åºåˆ—åŒ–æŒ‡å—ã€å®ç°æ€»ç»“ã€ä¸ºä»€ä¹ˆä½¿ç”¨ jsoniter
2. **æµ‹è¯•æ–‡æ¡£**: åºåˆ—åŒ–æµ‹è¯•è¦†ç›–ç‡ã€æµ‹è¯•è¯´æ˜ã€æµ‹è¯•è¦†ç›–ç‡åˆ†æ
3. **è¿ç§»æ–‡æ¡£**: DomainEvent è¿ç§»æ–¹æ¡ˆã€ç»Ÿä¸€ JSON è¿ç§»

---

### 2. outbox ç»„ä»¶

**æ–‡ä»¶**: `jxt-core/sdk/pkg/outbox/README.md`

#### ä¸»è¦æ›´æ–°å†…å®¹

##### âœ… æ›´æ–°ä¸šåŠ¡ä»£ç ä½¿ç”¨ç¤ºä¾‹
å°†åŸæ¥çš„å•ä¸€ç¤ºä¾‹æ‰©å±•ä¸ºä¸¤ç§æ–¹å¼ï¼š

**æ–¹å¼ 1ï¼šä½¿ç”¨ DomainEventï¼ˆæ¨èï¼‰**
```go
// 1. åˆ›å»º DomainEvent
domainEvent := jxtevent.NewEnterpriseDomainEvent(
    "Archive.Created",
    archive.ID,
    "Archive",
    payload,
)

// 2. åºåˆ—åŒ– DomainEvent
eventBytes, err := jxtevent.MarshalDomainEvent(domainEvent)

// 3. åˆ›å»º Outbox äº‹ä»¶
outboxEvent, err := outbox.NewOutboxEvent(
    tenantID,
    aggregateID,
    "Archive",
    "Archive.Created",
    eventBytes,  // ä¼ å…¥åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„
)
```

**æ–¹å¼ 2ï¼šç›´æ¥ä½¿ç”¨ Payloadï¼ˆç®€å•åœºæ™¯ï¼‰**
```go
// ç›´æ¥ä¼ å…¥ä¸šåŠ¡å¯¹è±¡
event, err := outbox.NewOutboxEvent(
    tenantID,
    aggregateID,
    "Archive",
    "ArchiveCreated",
    archive,  // ç›´æ¥ä¼ å…¥
)
```

å¹¶è¯´æ˜æ¨èä½¿ç”¨æ–¹å¼ 1 çš„åŸå› ï¼š
- âœ… ä½¿ç”¨æ ‡å‡†çš„ DomainEvent ç»“æ„
- âœ… åŒ…å«å®Œæ•´çš„äº‹ä»¶å…ƒæ•°æ®
- âœ… æ”¯æŒä¼ä¸šçº§å­—æ®µ
- âœ… ä¾¿äºäº‹ä»¶æº¯æºå’Œå®¡è®¡
- âœ… ä¸ Query Side ä¿æŒä¸€è‡´

##### âœ… æ–°å¢ä¸ DomainEvent é›†æˆç« èŠ‚
è¯¦ç»†è¯´æ˜äº† Command Side å’Œ Query Side çš„é›†æˆæ–¹å¼ï¼š

**Command Sideï¼ˆå‘å¸ƒç«¯ï¼‰**
```go
// 1. åˆ›å»º EnterpriseDomainEvent
// 2. åºåˆ—åŒ– DomainEvent
// 3. ä¿å­˜åˆ° Outbox
```

**Query Sideï¼ˆè®¢é˜…ç«¯ï¼‰**
```go
// 1. ä»æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶ Envelope
// 2. ååºåˆ—åŒ– DomainEvent
// 3. æå– Payload
```

##### âœ… æ–°å¢æ€§èƒ½ç‰¹æ€§è¯´æ˜
- é«˜æ€§èƒ½åºåˆ—åŒ–: ä½¿ç”¨ jxtjsonï¼Œæ¯”æ ‡å‡†åº“å¿« 2-3 å€
- åºåˆ—åŒ–æ€§èƒ½: ~690ns/op
- ååºåˆ—åŒ–æ€§èƒ½: ~1.2Î¼s/op
- å¹¶å‘å®‰å…¨: æ”¯æŒ 100+ goroutines

##### âœ… æ‰©å±•ç›¸å…³æ–‡æ¡£é“¾æ¥
æ–°å¢ä¸¤ä¸ªæ–‡æ¡£åˆ†ç±»ï¼š
1. **æ ¸å¿ƒæ–‡æ¡£**: å®Œæ•´è®¾è®¡æ–¹æ¡ˆã€å¿«é€Ÿå¼€å§‹æŒ‡å—ã€ä¾èµ–æ³¨å…¥è®¾è®¡
2. **é›†æˆæ–‡æ¡£**: DomainEvent åºåˆ—åŒ–æŒ‡å—ã€å®ç°æ€»ç»“ã€ç»Ÿä¸€ JSON è¿ç§»

---

### 3. eventbus ç»„ä»¶

**æ–‡ä»¶**: `jxt-core/sdk/pkg/eventbus/README.md`

#### ä¸»è¦æ›´æ–°å†…å®¹

##### âœ… æ‰©å±•åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
å°†åŸæ¥çš„å•ä¸€ç¤ºä¾‹æ‰©å±•ä¸ºä¸¤ä¸ªç¤ºä¾‹ï¼š

**ç¤ºä¾‹ 1ï¼šç®€å•æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…**
- ä¿ç•™åŸæœ‰çš„ç®€å•ç¤ºä¾‹

**ç¤ºä¾‹ 2ï¼šä½¿ç”¨ DomainEventï¼ˆæ¨èï¼‰**
```go
// è®¢é˜… DomainEvent
bus.SubscribeEnvelope(ctx, "archive-events", func(ctx context.Context, envelope *eventbus.Envelope) error {
    // 1. ååºåˆ—åŒ– DomainEvent
    domainEvent, err := jxtevent.UnmarshalDomainEvent[*jxtevent.EnterpriseDomainEvent](envelope.Payload)
    
    // 2. æå– Payload
    payload, err := jxtevent.UnmarshalPayload[ArchiveCreatedPayload](domainEvent)
    
    // 3. å¤„ç†ä¸šåŠ¡é€»è¾‘
    return handleArchiveCreated(ctx, payload)
})

// å‘å¸ƒ DomainEvent
domainEvent := jxtevent.NewEnterpriseDomainEvent(...)
eventBytes, _ := jxtevent.MarshalDomainEvent(domainEvent)
envelope := eventbus.NewEnvelope(...)
bus.PublishEnvelope(ctx, "archive-events", envelope)
```

##### âœ… æ–°å¢ä¸ DomainEvent é›†æˆç« èŠ‚
è¯¦ç»†è¯´æ˜äº†å‘å¸ƒç«¯å’Œè®¢é˜…ç«¯çš„é›†æˆæ–¹å¼ï¼š

**å‘å¸ƒç«¯ï¼ˆPublisherï¼‰**
1. åˆ›å»º DomainEvent
2. åºåˆ—åŒ–
3. åˆ›å»º Envelope
4. å‘å¸ƒ

**è®¢é˜…ç«¯ï¼ˆSubscriberï¼‰**
1. ååºåˆ—åŒ– DomainEvent
2. æå– Payload
3. å¤„ç†ä¸šåŠ¡é€»è¾‘

##### âœ… æ–°å¢æ€§èƒ½ç‰¹æ€§è¯´æ˜
- é«˜æ€§èƒ½åºåˆ—åŒ–: ä½¿ç”¨ jxtjsonï¼Œæ¯”æ ‡å‡†åº“å¿« 2-3 å€
- åºåˆ—åŒ–æ€§èƒ½: ~690ns/op
- ååºåˆ—åŒ–æ€§èƒ½: ~1.2Î¼s/op
- å¹¶å‘å®‰å…¨: æ”¯æŒ 100+ goroutines

##### âœ… æ‰©å±•ç›¸å…³æ–‡æ¡£é“¾æ¥
æ–°å¢ä¸‰ä¸ªæ–‡æ¡£åˆ†ç±»ï¼š
1. **EventBus æ ¸å¿ƒæ–‡æ¡£**: ACK å¤„ç†æœºåˆ¶ã€Outbox é›†æˆã€æ€§èƒ½ä¼˜åŒ–ã€Kafka æœ€ä½³å®è·µ
2. **DomainEvent é›†æˆæ–‡æ¡£**: åºåˆ—åŒ–æŒ‡å—ã€å®ç°æ€»ç»“ã€æ€§èƒ½åˆ†æã€ç»Ÿä¸€ JSON
3. **æµ‹è¯•æ–‡æ¡£**: åºåˆ—åŒ–æµ‹è¯•è¦†ç›–ç‡ã€å„ç§æµ‹è¯•ä»£ç 

##### âœ… æ–°å¢ç‰ˆæœ¬å†å²ç« èŠ‚
**v1.1.0 (2025-10-26) - DomainEvent é›†æˆå¢å¼º**
- æ–°å¢ DomainEvent é›†æˆç¤ºä¾‹
- æ–°å¢ SubscribeEnvelope ä½¿ç”¨ç¤ºä¾‹
- æ–°å¢åºåˆ—åŒ–æ€§èƒ½è¯´æ˜
- æ›´æ–°æ–‡æ¡£é“¾æ¥
- å®Œå–„ Envelope ä¸ DomainEvent çš„é›†æˆè¯´æ˜

---

## ğŸ“Š æ›´æ–°ç»Ÿè®¡

### æ–‡æ¡£æ›´æ–°é‡

| ç»„ä»¶ | æ–‡ä»¶ | æ–°å¢ç« èŠ‚ | æ›´æ–°ç« èŠ‚ | æ–°å¢ä»£ç ç¤ºä¾‹ |
|------|------|---------|---------|------------|
| **domain/event** | README.md | 2 | 3 | 2 |
| **outbox** | README.md | 2 | 1 | 3 |
| **eventbus** | README.md | 3 | 1 | 2 |
| **æ€»è®¡** | 3 ä¸ªæ–‡ä»¶ | 7 | 5 | 7 |

### æ–°å¢å†…å®¹ç±»å‹

- âœ… **æ€§èƒ½ç‰¹æ€§ç« èŠ‚**: 3 ä¸ªï¼ˆæ¯ä¸ªç»„ä»¶ 1 ä¸ªï¼‰
- âœ… **DomainEvent é›†æˆç« èŠ‚**: 2 ä¸ªï¼ˆoutboxã€eventbusï¼‰
- âœ… **ä»£ç ç¤ºä¾‹**: 7 ä¸ª
- âœ… **æ€§èƒ½æŒ‡æ ‡è¡¨æ ¼**: 3 ä¸ª
- âœ… **æ–‡æ¡£é“¾æ¥**: 20+ ä¸ª
- âœ… **ç‰ˆæœ¬å†å²**: 2 ä¸ªï¼ˆdomain/eventã€eventbusï¼‰

---

## ğŸ¯ æ›´æ–°ç›®æ ‡è¾¾æˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„ç›®æ ‡

1. **åæ˜ æœ€æ–°ä»£ç å˜æ›´**
   - âœ… æ›´æ–°äº†åºåˆ—åŒ–å®ç°ï¼ˆjxtjsonï¼‰
   - âœ… æ–°å¢äº† 21 ä¸ªåºåˆ—åŒ–æµ‹è¯•çš„è¯´æ˜
   - âœ… æ›´æ–°äº†æ€§èƒ½æŒ‡æ ‡

2. **å®Œå–„é›†æˆè¯´æ˜**
   - âœ… æ–°å¢ DomainEvent ä¸ Outbox çš„é›†æˆ
   - âœ… æ–°å¢ DomainEvent ä¸ EventBus çš„é›†æˆ
   - âœ… æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹

3. **æå‡æ–‡æ¡£è´¨é‡**
   - âœ… æ–°å¢æ€§èƒ½ç‰¹æ€§ç« èŠ‚
   - âœ… æ–°å¢æµ‹è¯•è¦†ç›–ç‡è¯´æ˜
   - âœ… æ‰©å±•ç›¸å…³æ–‡æ¡£é“¾æ¥
   - âœ… æ–°å¢ç‰ˆæœ¬å†å²

4. **ä¿æŒæ–‡æ¡£ä¸€è‡´æ€§**
   - âœ… ä¸‰ä¸ªç»„ä»¶çš„æ–‡æ¡£é£æ ¼ç»Ÿä¸€
   - âœ… ä»£ç ç¤ºä¾‹æ ¼å¼ä¸€è‡´
   - âœ… æ€§èƒ½æŒ‡æ ‡è¡¨è¿°ä¸€è‡´

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### æ–°å¢çš„æµ‹è¯•æ–‡æ¡£
- [åºåˆ—åŒ–æµ‹è¯•è¦†ç›–ç‡](./tests/domain/event/function_regression_tests/ENTERPRISE_SERIALIZATION_TEST_COVERAGE.md)
- [åºåˆ—åŒ–æµ‹è¯•è¯´æ˜](./tests/domain/event/function_regression_tests/ENTERPRISE_SERIALIZATION_TESTS_README.md)

### æ ¸å¿ƒç»„ä»¶æ–‡æ¡£
- [domain/event README](./sdk/pkg/domain/event/README.md)
- [outbox README](./sdk/pkg/outbox/README.md)
- [eventbus README](./sdk/pkg/eventbus/README.md)

### åºåˆ—åŒ–ç›¸å…³æ–‡æ¡£
- [åºåˆ—åŒ–æŒ‡å—](./sdk/pkg/domain/event/SERIALIZATION_GUIDE.md)
- [å®ç°æ€»ç»“](./sdk/pkg/domain/event/IMPLEMENTATION_SUMMARY.md)
- [ä¸ºä»€ä¹ˆä½¿ç”¨ jsoniter](./sdk/pkg/domain/event/WHY_JSONITER.md)
- [ç»Ÿä¸€ JSON è¿ç§»](./sdk/pkg/UNIFIED_JSON_MIGRATION.md)

---

## âœ… éªŒæ”¶æ ‡å‡†

æ‰€æœ‰æ›´æ–°éƒ½æ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š

1. âœ… **å‡†ç¡®æ€§** - æ‰€æœ‰ä¿¡æ¯å‡†ç¡®åæ˜ æœ€æ–°ä»£ç 
2. âœ… **å®Œæ•´æ€§** - è¦†ç›–æ‰€æœ‰é‡è¦çš„æ›´æ–°ç‚¹
3. âœ… **ä¸€è‡´æ€§** - ä¸‰ä¸ªç»„ä»¶æ–‡æ¡£é£æ ¼ç»Ÿä¸€
4. âœ… **å¯è¯»æ€§** - ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£
5. âœ… **å®ç”¨æ€§** - æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹
6. âœ… **å¯ç»´æŠ¤æ€§** - ä¾¿äºåç»­æ›´æ–°

---

**åˆ›å»ºæ—¶é—´**: 2025-10-26  
**ç»´æŠ¤è€…**: JXT Team  
**ç‰ˆæœ¬**: v1.0

