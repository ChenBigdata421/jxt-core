=== RUN   TestKafkaSubscriberBacklogMonitoring
    backlog_test.go:43: âœ… Kafka subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaSubscriberBacklogMonitoring (4.03s)
=== RUN   TestNATSSubscriberBacklogMonitoring
    backlog_test.go:78: âœ… NATS subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestNATSSubscriberBacklogMonitoring (4.01s)
=== RUN   TestKafkaPublisherBacklogMonitoring
    backlog_test.go:112: âœ… Kafka publisher backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaPublisherBacklogMonitoring (4.02s)
=== RUN   TestNATSPublisherBacklogMonitoring
    backlog_test.go:147: âœ… NATS publisher backlog monitoring test passed (callback called: false)
--- PASS: TestNATSPublisherBacklogMonitoring (4.01s)
=== RUN   TestKafkaStartAllBacklogMonitoring
    backlog_test.go:188: âœ… Kafka StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestKafkaStartAllBacklogMonitoring (4.01s)
=== RUN   TestNATSStartAllBacklogMonitoring
    backlog_test.go:231: âœ… NATS StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestNATSStartAllBacklogMonitoring (4.01s)
=== RUN   TestKafkaSetMessageRouter
    backlog_test.go:250: âœ… Kafka SetMessageRouter test passed
--- PASS: TestKafkaSetMessageRouter (1.01s)
=== RUN   TestNATSSetMessageRouter
    backlog_test.go:269: âœ… NATS SetMessageRouter test passed
--- PASS: TestNATSSetMessageRouter (1.01s)
=== RUN   TestKafkaSetErrorHandler
    backlog_test.go:297: âœ… Kafka SetErrorHandler test passed
--- PASS: TestKafkaSetErrorHandler (1.01s)
=== RUN   TestKafkaBasicPublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.basic.1760423627146
    basic_test.go:34: ğŸ“¨ Received message: Hello Kafka!
    basic_test.go:53: âœ… Kafka basic publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.basic.1760423627146
--- PASS: TestKafkaBasicPublishSubscribe (10.47s)
=== RUN   TestNATSBasicPublishSubscribe
    basic_test.go:80: ğŸ“¨ Received message: Hello NATS!
    basic_test.go:99: âœ… NATS basic publish/subscribe test passed
--- PASS: TestNATSBasicPublishSubscribe (4.12s)
=== RUN   TestKafkaMultipleMessages
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multiple.1760423641738
    basic_test.go:137: âœ… Kafka multiple messages test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multiple.1760423641738
--- PASS: TestKafkaMultipleMessages (10.49s)
=== RUN   TestNATSMultipleMessages
    basic_test.go:176: âœ… NATS multiple messages test passed
--- PASS: TestNATSMultipleMessages (4.12s)
=== RUN   TestKafkaPublishWithOptions
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.options.1760423656345
    basic_test.go:215: âœ… Kafka PublishWithOptions test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.options.1760423656345
--- PASS: TestKafkaPublishWithOptions (10.50s)
=== RUN   TestNATSPublishWithOptions
    basic_test.go:255: âœ… NATS PublishWithOptions test passed
--- PASS: TestNATSPublishWithOptions (4.12s)
=== RUN   TestKafkaEnvelopePublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.1760423670962
    envelope_test.go:33: ğŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:61: âœ… Kafka Envelope publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.1760423670962
--- PASS: TestKafkaEnvelopePublishSubscribe (10.49s)
=== RUN   TestNATSEnvelopePublishSubscribe
    envelope_test.go:84: ğŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:112: âœ… NATS Envelope publish/subscribe test passed
--- PASS: TestNATSEnvelopePublishSubscribe (4.12s)
=== RUN   TestKafkaEnvelopeOrdering
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.order.1760423685573
    envelope_test.go:177: âœ… Kafka Envelope ordering test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.order.1760423685573
--- PASS: TestKafkaEnvelopeOrdering (10.40s)
=== RUN   TestNATSEnvelopeOrdering
    envelope_test.go:243: âœ… NATS Envelope ordering test passed
--- PASS: TestNATSEnvelopeOrdering (4.12s)
=== RUN   TestKafkaMultipleAggregates
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multi.agg.1760423700093
    envelope_test.go:293: âœ… Kafka multiple aggregates test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multi.agg.1760423700093
--- PASS: TestKafkaMultipleAggregates (10.50s)
=== RUN   TestKafkaHealthCheckPublisher
    healthcheck_test.go:31: ğŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:35:10.604479 +0800 CST m=+110.590895801 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:37: âœ… Kafka health check publisher test passed
--- PASS: TestKafkaHealthCheckPublisher (4.01s)
=== RUN   TestNATSHealthCheckPublisher
    healthcheck_test.go:60: ğŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:35:14.6098845 +0800 CST m=+114.596301301 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:66: âœ… NATS health check publisher test passed
--- PASS: TestNATSHealthCheckPublisher (4.01s)
=== RUN   TestKafkaHealthCheckSubscriber
    healthcheck_test.go:88: ğŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:35:18.621796 +0800 CST m=+118.608212801 LastMessageTime:2025-10-14 14:35:18.8463125 +0800 CST m=+118.832729301 TotalMessagesReceived:2 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0007382}
    healthcheck_test.go:94: âœ… Kafka health check subscriber test passed
--- PASS: TestKafkaHealthCheckSubscriber (7.09s)
=== RUN   TestNATSHealthCheckSubscriber
    healthcheck_test.go:117: ğŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:35:25.7101956 +0800 CST m=+125.696612401 LastMessageTime:0001-01-01 00:00:00 +0000 UTC TotalMessagesReceived:0 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:false UptimeSeconds:3.0007136}
    healthcheck_test.go:123: âœ… NATS health check subscriber test passed
--- PASS: TestNATSHealthCheckSubscriber (4.01s)
=== RUN   TestKafkaStartAllHealthCheck
    healthcheck_test.go:146: ğŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:35:29.7199474 +0800 CST m=+129.706364201 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:147: ğŸ“Š Subscriber stats: {StartTime:2025-10-14 14:35:29.7199474 +0800 CST m=+129.706364201 LastMessageTime:2025-10-14 14:35:29.9340652 +0800 CST m=+129.920482001 TotalMessagesReceived:3 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.000536}
    healthcheck_test.go:153: âœ… Kafka StartAllHealthCheck test passed
--- PASS: TestKafkaStartAllHealthCheck (7.09s)
=== RUN   TestNATSStartAllHealthCheck
    healthcheck_test.go:177: ğŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:35:36.8109402 +0800 CST m=+136.797357001 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:178: ğŸ“Š Subscriber stats: {StartTime:2025-10-14 14:35:36.8109402 +0800 CST m=+136.797357001 LastMessageTime:2025-10-14 14:35:36.8120171 +0800 CST m=+136.798433901 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:3.0002534}
    healthcheck_test.go:184: âœ… NATS StartAllHealthCheck test passed
--- PASS: TestNATSStartAllHealthCheck (4.01s)
=== RUN   TestKafkaHealthCheckPublisherCallback
    healthcheck_test.go:205: ğŸ“ Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:35:40.8197724 +0800 CST m=+140.806189201 Duration:539.5Âµs Error:<nil> ConsecutiveFailures:0 EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:217: âœ… Kafka health check publisher callback test passed (callback called: true)
--- PASS: TestKafkaHealthCheckPublisherCallback (4.01s)
=== RUN   TestNATSHealthCheckPublisherCallback
    healthcheck_test.go:239: ğŸ“ Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:35:44.8303832 +0800 CST m=+144.816800001 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:251: âœ… NATS health check publisher callback test passed (callback called: true)
--- PASS: TestNATSHealthCheckPublisherCallback (4.01s)
=== RUN   TestKafkaHealthCheckSubscriberCallback
    healthcheck_test.go:284: âœ… Kafka health check subscriber callback test passed (callback called: false)
--- PASS: TestKafkaHealthCheckSubscriberCallback (10.08s)
=== RUN   TestKafkaHealthCheckPublisherSubscriberIntegration
    healthcheck_test.go:305: ğŸš€ A ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:310: ğŸš€ B ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:316: â³ ç­‰å¾…å¥åº·æ£€æŸ¥æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ï¼ˆ5ç§’ï¼‰...
    healthcheck_test.go:321: ğŸ“Š A ç«¯å‘å¸ƒå™¨çŠ¶æ€: IsHealthy=true, ConsecutiveFailures=0, LastSuccessTime=2025-10-14 14:35:58.9315297 +0800 CST m=+158.917946501
    healthcheck_test.go:343: ğŸ“Š B ç«¯è®¢é˜…å™¨ç»Ÿè®¡: TotalMessagesReceived=5, ConsecutiveMisses=0, IsHealthy=true, LastMessageTime=2025-10-14 14:35:59.1600631 +0800 CST m=+159.146479901
    healthcheck_test.go:363: âœ… B ç«¯è®¢é˜…å™¨åœ¨ 5 ç§’å†…æ¥æ”¶åˆ° 5 æ¡æ¶ˆæ¯ï¼Œç¬¦åˆé¢„æœŸ
    healthcheck_test.go:372: ğŸ›‘ åœæ­¢ A ç«¯å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:377: ğŸ›‘ åœæ­¢ B ç«¯å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:381: âœ… Kafka å¥åº·æ£€æŸ¥å‘å¸ƒç«¯å’Œè®¢é˜…ç«¯é›†æˆæµ‹è¯•é€šè¿‡
    healthcheck_test.go:382:    - A ç«¯æˆåŠŸå‘é€å¥åº·æ£€æŸ¥æ¶ˆæ¯
    healthcheck_test.go:383:    - B ç«¯æˆåŠŸæ¥æ”¶ 5 æ¡å¥åº·æ£€æŸ¥æ¶ˆæ¯
--- PASS: TestKafkaHealthCheckPublisherSubscriberIntegration (10.05s)
=== RUN   TestNATSHealthCheckPublisherSubscriberIntegration
    healthcheck_test.go:406: ğŸš€ A ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:411: ğŸš€ B ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:417: â³ ç­‰å¾…å¥åº·æ£€æŸ¥æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ï¼ˆ5ç§’ï¼‰...
    healthcheck_test.go:422: ğŸ“Š A ç«¯å‘å¸ƒå™¨çŠ¶æ€: IsHealthy=true, ConsecutiveFailures=0, LastSuccessTime=2025-10-14 14:36:08.9855019 +0800 CST m=+168.971918701
    healthcheck_test.go:444: ğŸ“Š B ç«¯è®¢é˜…å™¨ç»Ÿè®¡: TotalMessagesReceived=0, ConsecutiveMisses=0, IsHealthy=false, LastMessageTime=0001-01-01 00:00:00 +0000 UTC
    healthcheck_test.go:452: âŒ B ç«¯è®¢é˜…å™¨åº”è¯¥æ¥æ”¶åˆ°å¥åº·æ£€æŸ¥æ¶ˆæ¯ï¼Œä½†å®é™…æ¥æ”¶æ•°é‡ä¸º 0
    healthcheck_test.go:462: âš ï¸  B ç«¯è®¢é˜…å™¨åœ¨ 5 ç§’å†…åªæ¥æ”¶åˆ° 0 æ¡æ¶ˆæ¯ï¼Œé¢„æœŸè‡³å°‘ 3 æ¡
    healthcheck_test.go:469: âŒ B ç«¯è®¢é˜…å™¨åº”è¯¥æ¥æ”¶è¿‡æ¶ˆæ¯ï¼Œä½† LastMessageTime ä¸ºé›¶å€¼
    healthcheck_test.go:473: ğŸ›‘ åœæ­¢ A ç«¯å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:478: ğŸ›‘ åœæ­¢ B ç«¯å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:482: âœ… NATS å¥åº·æ£€æŸ¥å‘å¸ƒç«¯å’Œè®¢é˜…ç«¯é›†æˆæµ‹è¯•é€šè¿‡
    healthcheck_test.go:483:    - A ç«¯æˆåŠŸå‘é€å¥åº·æ£€æŸ¥æ¶ˆæ¯
    healthcheck_test.go:484:    - B ç«¯æˆåŠŸæ¥æ”¶ 0 æ¡å¥åº·æ£€æŸ¥æ¶ˆæ¯
--- FAIL: TestNATSHealthCheckPublisherSubscriberIntegration (7.02s)
=== RUN   TestKafkaStartStop
    lifecycle_test.go:31: âœ… Kafka Start/Stop test passed
--- PASS: TestKafkaStartStop (2.01s)
=== RUN   TestNATSStartStop
    lifecycle_test.go:56: âœ… NATS Start/Stop test passed
--- PASS: TestNATSStartStop (2.01s)
=== RUN   TestKafkaGetConnectionState
    lifecycle_test.go:69: ğŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 14:36:20.0123531 +0800 CST m=+179.998769901 ReconnectCount:0 LastError:}
    lifecycle_test.go:74: âœ… Kafka GetConnectionState test passed
--- PASS: TestKafkaGetConnectionState (1.01s)
=== RUN   TestNATSGetConnectionState
    lifecycle_test.go:88: ğŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 14:36:21.0234427 +0800 CST m=+181.009859501 ReconnectCount:0 LastError:}
    lifecycle_test.go:93: âœ… NATS GetConnectionState test passed
--- PASS: TestNATSGetConnectionState (1.01s)
=== RUN   TestKafkaGetMetrics
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.metrics.1760423782024
    lifecycle_test.go:121: ğŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 14:36:26.2410547 +0800 CST m=+186.227471501 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:126: âœ… Kafka GetMetrics test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.metrics.1760423782024
--- PASS: TestKafkaGetMetrics (7.22s)
=== RUN   TestNATSGetMetrics
    lifecycle_test.go:155: ğŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 14:36:31.265409 +0800 CST m=+191.251825801 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:160: âœ… NATS GetMetrics test passed
--- PASS: TestNATSGetMetrics (4.03s)
=== RUN   TestKafkaReconnectCallback
    lifecycle_test.go:181: âœ… Kafka RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestKafkaReconnectCallback (1.01s)
=== RUN   TestNATSReconnectCallback
    lifecycle_test.go:203: âœ… NATS RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestNATSReconnectCallback (1.01s)
=== RUN   TestKafkaClose
    lifecycle_test.go:223: âœ… Kafka Close test passed
--- PASS: TestKafkaClose (0.01s)
=== RUN   TestNATSClose
    lifecycle_test.go:244: âœ… NATS Close test passed
--- PASS: TestNATSClose (0.01s)
=== RUN   TestKafkaPublishCallback
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.pub.callback.1760423795310
    lifecycle_test.go:262: ğŸ“ Publish callback called: Topic=test.kafka.pub.callback.1760423795310, Error=<nil>
    lifecycle_test.go:276: âœ… Kafka RegisterPublishCallback test passed (callback called: true)
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.pub.callback.1760423795310
--- PASS: TestKafkaPublishCallback (7.24s)
=== RUN   TestKafkaTopicConfiguration
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.topic.config.1760423802547
    test_helper.go:204: ConfigureTopic should not return error: failed to configure topic test.kafka.topic.config.1760423802547: Kafka admin client not available
    topic_config_test.go:52: âœ… Kafka topic configuration test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.topic.config.1760423802547
--- FAIL: TestKafkaTopicConfiguration (5.13s)
=== RUN   TestNATSTopicConfiguration
    topic_config_test.go:96: âœ… NATS topic configuration test passed
--- PASS: TestNATSTopicConfiguration (2.02s)
=== RUN   TestKafkaSetTopicPersistence
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.persistence.1760423809698
    test_helper.go:204: SetTopicPersistence should not return error: failed to configure topic test.kafka.persistence.1760423809698: Kafka admin client not available
    topic_config_test.go:121: âœ… Kafka SetTopicPersistence test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.persistence.1760423809698
--- FAIL: TestKafkaSetTopicPersistence (5.13s)
=== RUN   TestNATSSetTopicPersistence
    topic_config_test.go:147: âœ… NATS SetTopicPersistence test passed
--- PASS: TestNATSSetTopicPersistence (2.02s)
=== RUN   TestKafkaRemoveTopicConfig
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.remove.config.1760423816844
    test_helper.go:204: ConfigureTopic should not return error: failed to configure topic test.kafka.remove.config.1760423816844: Kafka admin client not available
    topic_config_test.go:185: âœ… Kafka RemoveTopicConfig test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.remove.config.1760423816844
--- FAIL: TestKafkaRemoveTopicConfig (5.23s)
=== RUN   TestNATSRemoveTopicConfig
    topic_config_test.go:224: âœ… NATS RemoveTopicConfig test passed
--- PASS: TestNATSRemoveTopicConfig (2.01s)
=== RUN   TestKafkaTopicConfigStrategy
    topic_config_test.go:247: âœ… Kafka topic config strategy test passed
--- PASS: TestKafkaTopicConfigStrategy (1.01s)
=== RUN   TestNATSTopicConfigStrategy
    topic_config_test.go:271: âœ… NATS topic config strategy test passed
--- PASS: TestNATSTopicConfigStrategy (1.01s)
FAIL
FAIL	github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests	226.359s
FAIL
