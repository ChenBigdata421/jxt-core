=== RUN   TestKafkaSubscriberBacklogMonitoring
    backlog_test.go:43: âœ… Kafka subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaSubscriberBacklogMonitoring (4.04s)
=== RUN   TestNATSSubscriberBacklogMonitoring
    backlog_test.go:78: âœ… NATS subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestNATSSubscriberBacklogMonitoring (4.01s)
=== RUN   TestKafkaPublisherBacklogMonitoring
    backlog_test.go:112: âœ… Kafka publisher backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaPublisherBacklogMonitoring (4.01s)
=== RUN   TestNATSPublisherBacklogMonitoring
    backlog_test.go:147: âœ… NATS publisher backlog monitoring test passed (callback called: false)
--- PASS: TestNATSPublisherBacklogMonitoring (4.01s)
=== RUN   TestKafkaStartAllBacklogMonitoring
    backlog_test.go:188: âœ… Kafka StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestKafkaStartAllBacklogMonitoring (4.01s)
=== RUN   TestNATSStartAllBacklogMonitoring
    backlog_test.go:231: âœ… NATS StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestNATSStartAllBacklogMonitoring (4.01s)
=== RUN   TestKafkaSetMessageRouter
    backlog_test.go:250: âœ… Kafka SetMessageRouter test passed
--- PASS: TestKafkaSetMessageRouter (1.01s)
=== RUN   TestNATSSetMessageRouter
    backlog_test.go:269: âœ… NATS SetMessageRouter test passed
--- PASS: TestNATSSetMessageRouter (1.01s)
=== RUN   TestKafkaSetErrorHandler
    backlog_test.go:297: âœ… Kafka SetErrorHandler test passed
--- PASS: TestKafkaSetErrorHandler (1.01s)
=== RUN   TestKafkaBasicPublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.basic.1760421267353
    basic_test.go:34: ðŸ“¨ Received message: Hello Kafka!
    basic_test.go:53: âœ… Kafka basic publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.basic.1760421267353
--- PASS: TestKafkaBasicPublishSubscribe (10.51s)
=== RUN   TestNATSBasicPublishSubscribe
    basic_test.go:80: ðŸ“¨ Received message: Hello NATS!
    basic_test.go:99: âœ… NATS basic publish/subscribe test passed
--- PASS: TestNATSBasicPublishSubscribe (4.12s)
=== RUN   TestKafkaMultipleMessages
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multiple.1760421281975
    basic_test.go:137: âœ… Kafka multiple messages test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multiple.1760421281975
--- PASS: TestKafkaMultipleMessages (10.53s)
=== RUN   TestNATSMultipleMessages
    basic_test.go:176: âœ… NATS multiple messages test passed
--- PASS: TestNATSMultipleMessages (4.12s)
=== RUN   TestKafkaPublishWithOptions
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.options.1760421296625
    basic_test.go:215: âœ… Kafka PublishWithOptions test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.options.1760421296625
--- PASS: TestKafkaPublishWithOptions (10.41s)
=== RUN   TestNATSPublishWithOptions
    basic_test.go:255: âœ… NATS PublishWithOptions test passed
--- PASS: TestNATSPublishWithOptions (4.12s)
=== RUN   TestKafkaEnvelopePublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.1760421311157
    envelope_test.go:33: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:61: âœ… Kafka Envelope publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.1760421311157
--- PASS: TestKafkaEnvelopePublishSubscribe (10.41s)
=== RUN   TestNATSEnvelopePublishSubscribe
    envelope_test.go:84: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:112: âœ… NATS Envelope publish/subscribe test passed
--- PASS: TestNATSEnvelopePublishSubscribe (4.12s)
=== RUN   TestKafkaEnvelopeOrdering
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.order.1760421325685
    envelope_test.go:177: âœ… Kafka Envelope ordering test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.order.1760421325685
--- PASS: TestKafkaEnvelopeOrdering (10.50s)
=== RUN   TestNATSEnvelopeOrdering
    envelope_test.go:243: âœ… NATS Envelope ordering test passed
--- PASS: TestNATSEnvelopeOrdering (4.12s)
=== RUN   TestKafkaMultipleAggregates
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multi.agg.1760421340300
    envelope_test.go:293: âœ… Kafka multiple aggregates test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multi.agg.1760421340300
--- PASS: TestKafkaMultipleAggregates (10.52s)
=== RUN   TestKafkaHealthCheckPublisher
    healthcheck_test.go:31: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 13:55:50.8310513 +0800 CST m=+110.600359901 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:37: âœ… Kafka health check publisher test passed
--- PASS: TestKafkaHealthCheckPublisher (4.01s)
=== RUN   TestNATSHealthCheckPublisher
    healthcheck_test.go:60: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 13:55:54.8379 +0800 CST m=+114.607208601 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:66: âœ… NATS health check publisher test passed
--- PASS: TestNATSHealthCheckPublisher (4.01s)
=== RUN   TestKafkaHealthCheckSubscriber
    healthcheck_test.go:88: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 13:55:58.852744 +0800 CST m=+118.622052601 LastMessageTime:2025-10-14 13:55:59.0657973 +0800 CST m=+118.835105901 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0014036}
    healthcheck_test.go:94: âœ… Kafka health check subscriber test passed
--- PASS: TestKafkaHealthCheckSubscriber (7.06s)
=== RUN   TestNATSHealthCheckSubscriber
    healthcheck_test.go:117: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 13:56:05.9070155 +0800 CST m=+125.676324101 LastMessageTime:0001-01-01 00:00:00 +0000 UTC TotalMessagesReceived:0 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:false UptimeSeconds:3.0004471}
    healthcheck_test.go:123: âœ… NATS health check subscriber test passed
--- PASS: TestNATSHealthCheckSubscriber (4.01s)
=== RUN   TestKafkaStartAllHealthCheck
    healthcheck_test.go:146: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 13:56:09.915617 +0800 CST m=+129.684925601 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:147: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 13:56:09.915617 +0800 CST m=+129.684925601 LastMessageTime:2025-10-14 13:56:10.1301928 +0800 CST m=+129.899501401 TotalMessagesReceived:2 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0019209}
    healthcheck_test.go:153: âœ… Kafka StartAllHealthCheck test passed
--- PASS: TestKafkaStartAllHealthCheck (7.09s)
=== RUN   TestNATSStartAllHealthCheck
    healthcheck_test.go:177: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 13:56:17.0120423 +0800 CST m=+136.781350901 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:178: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 13:56:17.0120423 +0800 CST m=+136.781350901 LastMessageTime:2025-10-14 13:56:17.053433 +0800 CST m=+136.822741601 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:3.0003638}
    healthcheck_test.go:184: âœ… NATS StartAllHealthCheck test passed
--- PASS: TestNATSStartAllHealthCheck (4.01s)
=== RUN   TestKafkaHealthCheckPublisherCallback
    test_helper.go:204: RegisterHealthCheckPublisherCallback should not return error: health check publisher not started
    healthcheck_test.go:217: âœ… Kafka health check publisher callback test passed (callback called: false)
--- FAIL: TestKafkaHealthCheckPublisherCallback (4.01s)
=== RUN   TestNATSHealthCheckPublisherCallback
    test_helper.go:204: RegisterHealthCheckPublisherCallback should not return error: health check publisher not started
    healthcheck_test.go:251: âœ… NATS health check publisher callback test passed (callback called: false)
--- FAIL: TestNATSHealthCheckPublisherCallback (4.01s)
=== RUN   TestKafkaHealthCheckSubscriberCallback
    test_helper.go:204: RegisterHealthCheckSubscriberCallback should not return error: health check subscriber not started
    healthcheck_test.go:284: âœ… Kafka health check subscriber callback test passed (callback called: false)
--- FAIL: TestKafkaHealthCheckSubscriberCallback (7.10s)
=== RUN   TestKafkaStartStop
    lifecycle_test.go:31: âœ… Kafka Start/Stop test passed
--- FAIL: TestKafkaStartStop (1.02s)
panic: close of closed channel [recovered]
	panic: close of closed channel

goroutine 7035 [running]:
testing.tRunner.func1.2({0x1319400, 0x159f410})
	C:/Program Files/Go/src/testing/testing.go:1734 +0x219
testing.tRunner.func1()
	C:/Program Files/Go/src/testing/testing.go:1737 +0x359
panic({0x1319400?, 0x159f410?})
	C:/Program Files/Go/src/runtime/panic.go:792 +0x132
github.com/ChenBigdata421/jxt-core/sdk/pkg/eventbus.(*GlobalWorkerPool).Close(0xc000801860)
	D:/JXT/jxt-evidence-system/jxt-core/sdk/pkg/eventbus/kafka.go:200 +0x6f
github.com/ChenBigdata421/jxt-core/sdk/pkg/eventbus.(*kafkaEventBus).Close(0xc00100ea08)
	D:/JXT/jxt-evidence-system/jxt-core/sdk/pkg/eventbus/kafka.go:1507 +0x76
github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests.(*TestHelper).CloseEventBus(0xc000055ed0, {0x15bf010, 0xc00100ea08})
	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/function_tests/test_helper.go:272 +0xbd
github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests.TestKafkaStartStop(0xc000f7bc00)
	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/function_tests/lifecycle_test.go:32 +0x304
testing.tRunner(0xc000f7bc00, 0x14a3378)
	C:/Program Files/Go/src/testing/testing.go:1792 +0xcb
created by testing.(*T).Run in goroutine 1
	C:/Program Files/Go/src/testing/testing.go:1851 +0x3f6
FAIL	github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests	157.457s
FAIL
