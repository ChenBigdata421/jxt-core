=== RUN   TestKafkaSubscriberBacklogMonitoring
    backlog_test.go:43: âœ… Kafka subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaSubscriberBacklogMonitoring (4.03s)
=== RUN   TestNATSSubscriberBacklogMonitoring
    backlog_test.go:78: âœ… NATS subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestNATSSubscriberBacklogMonitoring (4.01s)
=== RUN   TestKafkaPublisherBacklogMonitoring
    backlog_test.go:112: âœ… Kafka publisher backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaPublisherBacklogMonitoring (4.01s)
=== RUN   TestNATSPublisherBacklogMonitoring
    backlog_test.go:147: âœ… NATS publisher backlog monitoring test passed (callback called: false)
--- PASS: TestNATSPublisherBacklogMonitoring (4.01s)
=== RUN   TestKafkaStartAllBacklogMonitoring
    backlog_test.go:188: âœ… Kafka StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestKafkaStartAllBacklogMonitoring (4.01s)
=== RUN   TestNATSStartAllBacklogMonitoring
    backlog_test.go:231: âœ… NATS StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestNATSStartAllBacklogMonitoring (4.01s)
=== RUN   TestKafkaSetMessageRouter
    backlog_test.go:250: âœ… Kafka SetMessageRouter test passed
--- PASS: TestKafkaSetMessageRouter (1.01s)
=== RUN   TestNATSSetMessageRouter
    backlog_test.go:269: âœ… NATS SetMessageRouter test passed
--- PASS: TestNATSSetMessageRouter (1.01s)
=== RUN   TestKafkaSetErrorHandler
    backlog_test.go:297: âœ… Kafka SetErrorHandler test passed
--- PASS: TestKafkaSetErrorHandler (1.01s)
=== RUN   TestKafkaBasicPublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.basic.1760422644090
    basic_test.go:34: ðŸ“¨ Received message: Hello Kafka!
    basic_test.go:53: âœ… Kafka basic publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.basic.1760422644090
--- PASS: TestKafkaBasicPublishSubscribe (10.53s)
=== RUN   TestNATSBasicPublishSubscribe
    basic_test.go:80: ðŸ“¨ Received message: Hello NATS!
    basic_test.go:99: âœ… NATS basic publish/subscribe test passed
--- PASS: TestNATSBasicPublishSubscribe (4.12s)
=== RUN   TestKafkaMultipleMessages
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multiple.1760422658745
    basic_test.go:137: âœ… Kafka multiple messages test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multiple.1760422658745
--- PASS: TestKafkaMultipleMessages (10.52s)
=== RUN   TestNATSMultipleMessages
    basic_test.go:176: âœ… NATS multiple messages test passed
--- PASS: TestNATSMultipleMessages (4.12s)
=== RUN   TestKafkaPublishWithOptions
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.options.1760422673383
    basic_test.go:215: âœ… Kafka PublishWithOptions test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.options.1760422673383
--- PASS: TestKafkaPublishWithOptions (10.46s)
=== RUN   TestNATSPublishWithOptions
    basic_test.go:255: âœ… NATS PublishWithOptions test passed
--- PASS: TestNATSPublishWithOptions (4.12s)
=== RUN   TestKafkaEnvelopePublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.1760422687966
    envelope_test.go:33: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:61: âœ… Kafka Envelope publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.1760422687966
--- PASS: TestKafkaEnvelopePublishSubscribe (10.51s)
=== RUN   TestNATSEnvelopePublishSubscribe
    envelope_test.go:84: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:112: âœ… NATS Envelope publish/subscribe test passed
--- PASS: TestNATSEnvelopePublishSubscribe (4.12s)
=== RUN   TestKafkaEnvelopeOrdering
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.order.1760422702596
    envelope_test.go:177: âœ… Kafka Envelope ordering test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.order.1760422702596
--- PASS: TestKafkaEnvelopeOrdering (10.51s)
=== RUN   TestNATSEnvelopeOrdering
    envelope_test.go:243: âœ… NATS Envelope ordering test passed
--- PASS: TestNATSEnvelopeOrdering (4.12s)
=== RUN   TestKafkaMultipleAggregates
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multi.agg.1760422717223
    envelope_test.go:293: âœ… Kafka multiple aggregates test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multi.agg.1760422717223
--- PASS: TestKafkaMultipleAggregates (10.50s)
=== RUN   TestKafkaHealthCheckPublisher
    healthcheck_test.go:31: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:18:47.7314979 +0800 CST m=+110.757706601 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:37: âœ… Kafka health check publisher test passed
--- PASS: TestKafkaHealthCheckPublisher (4.01s)
=== RUN   TestNATSHealthCheckPublisher
    healthcheck_test.go:60: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:18:51.7390414 +0800 CST m=+114.765250101 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:66: âœ… NATS health check publisher test passed
--- PASS: TestNATSHealthCheckPublisher (4.01s)
=== RUN   TestKafkaHealthCheckSubscriber
    healthcheck_test.go:88: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:18:55.7511367 +0800 CST m=+118.777345401 LastMessageTime:2025-10-14 14:18:55.977121 +0800 CST m=+119.003329701 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0008471}
    healthcheck_test.go:94: âœ… Kafka health check subscriber test passed
--- PASS: TestKafkaHealthCheckSubscriber (7.08s)
=== RUN   TestNATSHealthCheckSubscriber
    healthcheck_test.go:117: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:19:02.833736 +0800 CST m=+125.859944701 LastMessageTime:0001-01-01 00:00:00 +0000 UTC TotalMessagesReceived:0 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:false UptimeSeconds:3.00079}
    healthcheck_test.go:123: âœ… NATS health check subscriber test passed
--- PASS: TestNATSHealthCheckSubscriber (4.01s)
=== RUN   TestKafkaStartAllHealthCheck
    healthcheck_test.go:146: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:19:06.8409552 +0800 CST m=+129.867163901 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:147: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 14:19:06.8409552 +0800 CST m=+129.867163901 LastMessageTime:2025-10-14 14:19:07.054807 +0800 CST m=+130.081015701 TotalMessagesReceived:2 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0004999}
    healthcheck_test.go:153: âœ… Kafka StartAllHealthCheck test passed
--- PASS: TestKafkaStartAllHealthCheck (7.06s)
=== RUN   TestNATSStartAllHealthCheck
    healthcheck_test.go:177: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:19:13.9060654 +0800 CST m=+136.932274101 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:178: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 14:19:13.9060654 +0800 CST m=+136.932274101 LastMessageTime:2025-10-14 14:19:13.9460147 +0800 CST m=+136.972223401 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:3.0001402}
    healthcheck_test.go:184: âœ… NATS StartAllHealthCheck test passed
--- PASS: TestNATSStartAllHealthCheck (4.01s)
=== RUN   TestKafkaHealthCheckPublisherCallback
    healthcheck_test.go:205: ðŸ“ž Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:19:17.9114896 +0800 CST m=+140.937698301 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:217: âœ… Kafka health check publisher callback test passed (callback called: true)
--- PASS: TestKafkaHealthCheckPublisherCallback (4.01s)
=== RUN   TestNATSHealthCheckPublisherCallback
    healthcheck_test.go:239: ðŸ“ž Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:19:21.9224664 +0800 CST m=+144.948675101 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:251: âœ… NATS health check publisher callback test passed (callback called: true)
--- PASS: TestNATSHealthCheckPublisherCallback (4.01s)
=== RUN   TestKafkaHealthCheckSubscriberCallback
    healthcheck_test.go:284: âœ… Kafka health check subscriber callback test passed (callback called: false)
--- PASS: TestKafkaHealthCheckSubscriberCallback (10.09s)
=== RUN   TestKafkaStartStop
    lifecycle_test.go:31: âœ… Kafka Start/Stop test passed
--- PASS: TestKafkaStartStop (2.01s)
=== RUN   TestNATSStartStop
    lifecycle_test.go:56: âœ… NATS Start/Stop test passed
--- PASS: TestNATSStartStop (2.01s)
=== RUN   TestKafkaGetConnectionState
    lifecycle_test.go:69: ðŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 14:19:40.0322992 +0800 CST m=+163.058507901 ReconnectCount:0 LastError:}
    lifecycle_test.go:74: âœ… Kafka GetConnectionState test passed
--- PASS: TestKafkaGetConnectionState (1.01s)
=== RUN   TestNATSGetConnectionState
    lifecycle_test.go:88: ðŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 14:19:41.0437939 +0800 CST m=+164.070002601 ReconnectCount:0 LastError:}
    lifecycle_test.go:93: âœ… NATS GetConnectionState test passed
--- PASS: TestNATSGetConnectionState (1.01s)
=== RUN   TestKafkaGetMetrics
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.metrics.1760422782044
    lifecycle_test.go:121: ðŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 14:19:46.1617944 +0800 CST m=+169.188003101 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:126: âœ… Kafka GetMetrics test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.metrics.1760422782044
--- PASS: TestKafkaGetMetrics (7.13s)
=== RUN   TestNATSGetMetrics
    lifecycle_test.go:155: ðŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 14:19:51.1874268 +0800 CST m=+174.213635501 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:160: âœ… NATS GetMetrics test passed
--- PASS: TestNATSGetMetrics (4.01s)
=== RUN   TestKafkaReconnectCallback
    lifecycle_test.go:181: âœ… Kafka RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestKafkaReconnectCallback (1.01s)
=== RUN   TestNATSReconnectCallback
    lifecycle_test.go:203: âœ… NATS RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestNATSReconnectCallback (1.01s)
=== RUN   TestKafkaClose
    lifecycle_test.go:223: âœ… Kafka Close test passed
--- PASS: TestKafkaClose (0.01s)
=== RUN   TestNATSClose
    lifecycle_test.go:244: âœ… NATS Close test passed
--- PASS: TestNATSClose (0.00s)
=== RUN   TestKafkaPublishCallback
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.pub.callback.1760422795220
    lifecycle_test.go:262: ðŸ“ž Publish callback called: Topic=test.kafka.pub.callback.1760422795220, Error=<nil>
    lifecycle_test.go:276: âœ… Kafka RegisterPublishCallback test passed (callback called: true)
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.pub.callback.1760422795220
--- PASS: TestKafkaPublishCallback (7.23s)
=== RUN   TestKafkaTopicConfiguration
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.topic.config.1760422802454
    test_helper.go:204: ConfigureTopic should not return error: failed to configure topic test.kafka.topic.config.1760422802454: Kafka admin client not available
    topic_config_test.go:52: âœ… Kafka topic configuration test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.topic.config.1760422802454
--- FAIL: TestKafkaTopicConfiguration (5.23s)
=== RUN   TestNATSTopicConfiguration
    topic_config_test.go:96: âœ… NATS topic configuration test passed
--- PASS: TestNATSTopicConfiguration (2.01s)
=== RUN   TestKafkaSetTopicPersistence
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.persistence.1760422809702
    test_helper.go:204: SetTopicPersistence should not return error: failed to configure topic test.kafka.persistence.1760422809702: Kafka admin client not available
    topic_config_test.go:121: âœ… Kafka SetTopicPersistence test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.persistence.1760422809702
--- FAIL: TestKafkaSetTopicPersistence (5.23s)
=== RUN   TestNATSSetTopicPersistence
    topic_config_test.go:147: âœ… NATS SetTopicPersistence test passed
--- PASS: TestNATSSetTopicPersistence (2.01s)
=== RUN   TestKafkaRemoveTopicConfig
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.remove.config.1760422816942
    test_helper.go:204: ConfigureTopic should not return error: failed to configure topic test.kafka.remove.config.1760422816942: Kafka admin client not available
    topic_config_test.go:185: âœ… Kafka RemoveTopicConfig test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.remove.config.1760422816942
--- FAIL: TestKafkaRemoveTopicConfig (5.22s)
=== RUN   TestNATSRemoveTopicConfig
    topic_config_test.go:224: âœ… NATS RemoveTopicConfig test passed
--- PASS: TestNATSRemoveTopicConfig (2.01s)
=== RUN   TestKafkaTopicConfigStrategy
    topic_config_test.go:247: âœ… Kafka topic config strategy test passed
--- PASS: TestKafkaTopicConfigStrategy (1.01s)
=== RUN   TestNATSTopicConfigStrategy
    topic_config_test.go:271: âœ… NATS topic config strategy test passed
--- PASS: TestNATSTopicConfigStrategy (1.01s)
FAIL
FAIL	github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests	209.525s
FAIL
