=== RUN   TestKafkaSubscriberBacklogMonitoring
    backlog_test.go:43: âœ… Kafka subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaSubscriberBacklogMonitoring (4.03s)
=== RUN   TestNATSSubscriberBacklogMonitoring
    backlog_test.go:78: âœ… NATS subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestNATSSubscriberBacklogMonitoring (4.01s)
=== RUN   TestKafkaPublisherBacklogMonitoring
    backlog_test.go:112: âœ… Kafka publisher backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaPublisherBacklogMonitoring (4.01s)
=== RUN   TestNATSPublisherBacklogMonitoring
    backlog_test.go:147: âœ… NATS publisher backlog monitoring test passed (callback called: false)
--- PASS: TestNATSPublisherBacklogMonitoring (4.01s)
=== RUN   TestKafkaStartAllBacklogMonitoring
    backlog_test.go:188: âœ… Kafka StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestKafkaStartAllBacklogMonitoring (4.01s)
=== RUN   TestNATSStartAllBacklogMonitoring
    backlog_test.go:231: âœ… NATS StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestNATSStartAllBacklogMonitoring (4.01s)
=== RUN   TestKafkaSetMessageRouter
    backlog_test.go:250: âœ… Kafka SetMessageRouter test passed
--- PASS: TestKafkaSetMessageRouter (1.01s)
=== RUN   TestNATSSetMessageRouter
    backlog_test.go:269: âœ… NATS SetMessageRouter test passed
--- PASS: TestNATSSetMessageRouter (1.01s)
=== RUN   TestKafkaSetErrorHandler
    backlog_test.go:297: âœ… Kafka SetErrorHandler test passed
--- PASS: TestKafkaSetErrorHandler (1.01s)
=== RUN   TestKafkaBasicPublishSubscribe
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.basic.1760427178607
    basic_test.go:34: ğŸ“¨ Received message: Hello Kafka!
    basic_test.go:53: âœ… Kafka basic publish/subscribe test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.basic.1760427178607
--- PASS: TestKafkaBasicPublishSubscribe (10.50s)
=== RUN   TestNATSBasicPublishSubscribe
    basic_test.go:80: ğŸ“¨ Received message: Hello NATS!
    basic_test.go:99: âœ… NATS basic publish/subscribe test passed
--- PASS: TestNATSBasicPublishSubscribe (4.12s)
=== RUN   TestKafkaMultipleMessages
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.multiple.1760427193225
    basic_test.go:137: âœ… Kafka multiple messages test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.multiple.1760427193225
--- PASS: TestKafkaMultipleMessages (10.59s)
=== RUN   TestNATSMultipleMessages
    basic_test.go:176: âœ… NATS multiple messages test passed
--- PASS: TestNATSMultipleMessages (4.12s)
=== RUN   TestKafkaPublishWithOptions
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.options.1760427207930
    basic_test.go:215: âœ… Kafka PublishWithOptions test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.options.1760427207930
--- PASS: TestKafkaPublishWithOptions (10.37s)
=== RUN   TestNATSPublishWithOptions
    basic_test.go:255: âœ… NATS PublishWithOptions test passed
--- PASS: TestNATSPublishWithOptions (4.12s)
=== RUN   TestKafkaEnvelopePublishSubscribe
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.envelope.1760427222415
    envelope_test.go:33: ğŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:61: âœ… Kafka Envelope publish/subscribe test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.envelope.1760427222415
--- PASS: TestKafkaEnvelopePublishSubscribe (10.49s)
=== RUN   TestNATSEnvelopePublishSubscribe
    envelope_test.go:84: ğŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:112: âœ… NATS Envelope publish/subscribe test passed
--- PASS: TestNATSEnvelopePublishSubscribe (4.12s)
=== RUN   TestKafkaEnvelopeOrdering
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.envelope.order.1760427237021
    envelope_test.go:177: âœ… Kafka Envelope ordering test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.envelope.order.1760427237021
--- PASS: TestKafkaEnvelopeOrdering (10.39s)
=== RUN   TestNATSEnvelopeOrdering
    envelope_test.go:243: âœ… NATS Envelope ordering test passed
--- PASS: TestNATSEnvelopeOrdering (4.11s)
=== RUN   TestKafkaMultipleAggregates
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.multi.agg.1760427251522
    envelope_test.go:293: âœ… Kafka multiple aggregates test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.multi.agg.1760427251522
--- PASS: TestKafkaMultipleAggregates (10.36s)
=== RUN   TestKafkaHealthCheckPublisher
    healthcheck_test.go:32: ğŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 15:34:21.8932217 +0800 CST m=+110.393060901 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:38: âœ… Kafka health check publisher test passed
--- PASS: TestKafkaHealthCheckPublisher (4.01s)
=== RUN   TestNATSHealthCheckPublisher
    healthcheck_test.go:61: ğŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 15:34:25.8992201 +0800 CST m=+114.399059301 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:67: âœ… NATS health check publisher test passed
--- PASS: TestNATSHealthCheckPublisher (4.01s)
=== RUN   TestKafkaHealthCheckSubscriber
    healthcheck_test.go:89: ğŸ“Š Health check subscriber stats: {StartTime:2025-10-14 15:34:29.9114035 +0800 CST m=+118.411242701 LastMessageTime:2025-10-14 15:34:30.1274255 +0800 CST m=+118.627264701 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0007411}
    healthcheck_test.go:95: âœ… Kafka health check subscriber test passed
--- PASS: TestKafkaHealthCheckSubscriber (7.08s)
=== RUN   TestNATSHealthCheckSubscriber
    healthcheck_test.go:118: ğŸ“Š Health check subscriber stats: {StartTime:2025-10-14 15:34:36.9940901 +0800 CST m=+125.493929301 LastMessageTime:0001-01-01 00:00:00 +0000 UTC TotalMessagesReceived:0 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:false UptimeSeconds:3.0002376}
    healthcheck_test.go:124: âœ… NATS health check subscriber test passed
--- PASS: TestNATSHealthCheckSubscriber (4.01s)
=== RUN   TestKafkaStartAllHealthCheck
    healthcheck_test.go:147: ğŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 15:34:41.0019076 +0800 CST m=+129.501746801 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:148: ğŸ“Š Subscriber stats: {StartTime:2025-10-14 15:34:41.0019076 +0800 CST m=+129.501746801 LastMessageTime:2025-10-14 15:34:41.2168296 +0800 CST m=+129.716668801 TotalMessagesReceived:2 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0002645}
    healthcheck_test.go:154: âœ… Kafka StartAllHealthCheck test passed
--- PASS: TestKafkaStartAllHealthCheck (7.06s)
=== RUN   TestNATSStartAllHealthCheck
    healthcheck_test.go:178: ğŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 15:34:48.0632591 +0800 CST m=+136.563098301 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:179: ğŸ“Š Subscriber stats: {StartTime:2025-10-14 15:34:48.0632591 +0800 CST m=+136.563098301 LastMessageTime:2025-10-14 15:34:48.1074885 +0800 CST m=+136.607327701 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:3.0001772}
    healthcheck_test.go:185: âœ… NATS StartAllHealthCheck test passed
--- PASS: TestNATSStartAllHealthCheck (4.01s)
=== RUN   TestKafkaHealthCheckPublisherCallback
    healthcheck_test.go:206: ğŸ“ Health check publisher callback called: {Success:true Timestamp:2025-10-14 15:34:52.0713565 +0800 CST m=+140.571195701 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:218: âœ… Kafka health check publisher callback test passed (callback called: true)
--- PASS: TestKafkaHealthCheckPublisherCallback (4.01s)
=== RUN   TestNATSHealthCheckPublisherCallback
    healthcheck_test.go:240: ğŸ“ Health check publisher callback called: {Success:true Timestamp:2025-10-14 15:34:56.0811508 +0800 CST m=+144.580990001 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:252: âœ… NATS health check publisher callback test passed (callback called: true)
--- PASS: TestNATSHealthCheckPublisherCallback (4.01s)
=== RUN   TestKafkaHealthCheckSubscriberCallback
    healthcheck_test.go:285: âœ… Kafka health check subscriber callback test passed (callback called: false)
--- PASS: TestKafkaHealthCheckSubscriberCallback (10.06s)
=== RUN   TestKafkaHealthCheckPublisherSubscriberIntegration
    healthcheck_test.go:332: ğŸš€ A ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥å‘å¸ƒå™¨ï¼ˆé—´éš”ï¼š10ç§’ï¼‰
    healthcheck_test.go:337: ğŸš€ B ç«¯ï¼šå¯åŠ¨å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:343: â³ ç­‰å¾…å¥åº·æ£€æŸ¥æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ï¼ˆ1åˆ†é’Ÿï¼‰...
    healthcheck_test.go:344: âœ… EventBus ç°åœ¨ä½¿ç”¨è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é…ç½®ï¼ˆé—´éš”ï¼š10ç§’ï¼‰
    healthcheck_test.go:349: ğŸ“Š A ç«¯å‘å¸ƒå™¨çŠ¶æ€: IsHealthy=true, ConsecutiveFailures=0, LastSuccessTime=2025-10-14 15:36:10.152767 +0800 CST m=+218.652606201
    healthcheck_test.go:371: ğŸ“Š B ç«¯è®¢é˜…å™¨ç»Ÿè®¡: TotalMessagesReceived=10, ConsecutiveMisses=0, IsHealthy=true, LastMessageTime=2025-10-14 15:36:10.2538842 +0800 CST m=+218.753723401
    healthcheck_test.go:392: âš ï¸  B ç«¯è®¢é˜…å™¨åœ¨ 1 åˆ†é’Ÿå†…æ¥æ”¶åˆ° 10 æ¡æ¶ˆæ¯ï¼Œè¶…è¿‡é¢„æœŸçš„ 8 æ¡
    healthcheck_test.go:403: ğŸ›‘ åœæ­¢ A ç«¯å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:408: ğŸ›‘ åœæ­¢ B ç«¯å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:412: âœ… Kafka å¥åº·æ£€æŸ¥å‘å¸ƒç«¯å’Œè®¢é˜…ç«¯é›†æˆæµ‹è¯•é€šè¿‡
    healthcheck_test.go:413:    - A ç«¯æˆåŠŸå‘é€å¥åº·æ£€æŸ¥æ¶ˆæ¯ï¼ˆè‡ªå®šä¹‰é—´éš”ï¼š10ç§’ï¼‰
    healthcheck_test.go:414:    - B ç«¯æˆåŠŸæ¥æ”¶ 10 æ¡å¥åº·æ£€æŸ¥æ¶ˆæ¯ï¼ˆæµ‹è¯•æ—¶é•¿ï¼š1åˆ†é’Ÿï¼‰
--- PASS: TestKafkaHealthCheckPublisherSubscriberIntegration (65.10s)
=== RUN   TestNATSHealthCheckPublisherSubscriberIntegration
    healthcheck_test.go:460: ğŸš€ B ç«¯ï¼šå…ˆå¯åŠ¨å¥åº·æ£€æŸ¥è®¢é˜…å™¨ï¼ˆNATS Core éœ€è¦å…ˆè®¢é˜…ï¼‰
    healthcheck_test.go:468: ğŸš€ A ç«¯ï¼šå†å¯åŠ¨å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:474: â³ ç­‰å¾…å¥åº·æ£€æŸ¥æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ï¼ˆ1åˆ†é’Ÿï¼‰...
    healthcheck_test.go:475: âœ… EventBus ç°åœ¨ä½¿ç”¨è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é…ç½®ï¼ˆé—´éš”ï¼š10ç§’ï¼‰
    healthcheck_test.go:480: ğŸ“Š A ç«¯å‘å¸ƒå™¨çŠ¶æ€: IsHealthy=true, ConsecutiveFailures=0, LastSuccessTime=2025-10-14 15:37:06.2536565 +0800 CST m=+274.753495701
    healthcheck_test.go:502: ğŸ“Š B ç«¯è®¢é˜…å™¨ç»Ÿè®¡: TotalMessagesReceived=6, ConsecutiveMisses=0, IsHealthy=true, LastMessageTime=2025-10-14 15:37:06.2559794 +0800 CST m=+274.755818601
    healthcheck_test.go:525: âœ… B ç«¯è®¢é˜…å™¨åœ¨ 1 åˆ†é’Ÿå†…æ¥æ”¶åˆ° 6 æ¡æ¶ˆæ¯ï¼Œç¬¦åˆé¢„æœŸï¼ˆ5-8 æ¡ï¼‰
    healthcheck_test.go:534: ğŸ›‘ åœæ­¢ A ç«¯å¥åº·æ£€æŸ¥å‘å¸ƒå™¨
    healthcheck_test.go:539: ğŸ›‘ åœæ­¢ B ç«¯å¥åº·æ£€æŸ¥è®¢é˜…å™¨
    healthcheck_test.go:543: âœ… NATS å¥åº·æ£€æŸ¥å‘å¸ƒç«¯å’Œè®¢é˜…ç«¯é›†æˆæµ‹è¯•é€šè¿‡
    healthcheck_test.go:544:    - A ç«¯æˆåŠŸå‘é€å¥åº·æ£€æŸ¥æ¶ˆæ¯ï¼ˆè‡ªå®šä¹‰é—´éš”ï¼š10ç§’ï¼‰
    healthcheck_test.go:545:    - B ç«¯æˆåŠŸæ¥æ”¶ 6 æ¡å¥åº·æ£€æŸ¥æ¶ˆæ¯ï¼ˆæµ‹è¯•æ—¶é•¿ï¼š1åˆ†é’Ÿï¼‰
--- PASS: TestNATSHealthCheckPublisherSubscriberIntegration (63.02s)
=== RUN   TestKafkaStartStop
    lifecycle_test.go:31: âœ… Kafka Start/Stop test passed
--- PASS: TestKafkaStartStop (2.01s)
=== RUN   TestNATSStartStop
    lifecycle_test.go:56: âœ… NATS Start/Stop test passed
--- PASS: TestNATSStartStop (2.01s)
=== RUN   TestKafkaGetConnectionState
    lifecycle_test.go:69: ğŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 15:37:22.2820544 +0800 CST m=+290.781893601 ReconnectCount:0 LastError:}
    lifecycle_test.go:74: âœ… Kafka GetConnectionState test passed
--- PASS: TestKafkaGetConnectionState (1.01s)
=== RUN   TestNATSGetConnectionState
    lifecycle_test.go:88: ğŸ“Š Connection state: {IsConnected:true LastConnectedTime:2025-10-14 15:37:23.2937562 +0800 CST m=+291.793595401 ReconnectCount:0 LastError:}
    lifecycle_test.go:93: âœ… NATS GetConnectionState test passed
--- PASS: TestNATSGetConnectionState (1.01s)
=== RUN   TestKafkaGetMetrics
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.metrics.1760427444294
    lifecycle_test.go:121: ğŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 15:37:28.5236263 +0800 CST m=+297.023465501 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:126: âœ… Kafka GetMetrics test passed
    test_helper.go:201: âœ… Deleted Kafka topic: test.kafka.metrics.1760427444294
--- PASS: TestKafkaGetMetrics (7.24s)
=== RUN   TestNATSGetMetrics
    lifecycle_test.go:155: ğŸ“Š Metrics: {MessagesPublished:5 MessagesConsumed:0 PublishErrors:0 ConsumeErrors:0 ConnectionErrors:0 LastHealthCheck:2025-10-14 15:37:33.5383173 +0800 CST m=+302.038156501 HealthCheckStatus:healthy ActiveConnections:1 MessageBacklog:0}
    lifecycle_test.go:160: âœ… NATS GetMetrics test passed
--- PASS: TestNATSGetMetrics (4.02s)
=== RUN   TestKafkaReconnectCallback
    lifecycle_test.go:181: âœ… Kafka RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestKafkaReconnectCallback (1.01s)
=== RUN   TestNATSReconnectCallback
    lifecycle_test.go:203: âœ… NATS RegisterReconnectCallback test passed (callback registered: true)
--- PASS: TestNATSReconnectCallback (1.01s)
=== RUN   TestKafkaClose
    lifecycle_test.go:223: âœ… Kafka Close test passed
--- PASS: TestKafkaClose (0.01s)
=== RUN   TestNATSClose
    lifecycle_test.go:244: âœ… NATS Close test passed
--- PASS: TestNATSClose (0.01s)
=== RUN   TestKafkaPublishCallback
    test_helper.go:318: âœ… Created Kafka topic: test.kafka.pub.callback.1760427457573
    lifecycle_test.go:262: ğŸ“ Publish callback called: Topic=test.kafka.pub.callback.1760427457573, Error=<nil>
