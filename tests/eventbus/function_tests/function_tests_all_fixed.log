=== RUN   TestKafkaSubscriberBacklogMonitoring
    backlog_test.go:43: âœ… Kafka subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaSubscriberBacklogMonitoring (4.04s)
=== RUN   TestNATSSubscriberBacklogMonitoring
    backlog_test.go:78: âœ… NATS subscriber backlog monitoring test passed (callback called: false)
--- PASS: TestNATSSubscriberBacklogMonitoring (4.01s)
=== RUN   TestKafkaPublisherBacklogMonitoring
    backlog_test.go:112: âœ… Kafka publisher backlog monitoring test passed (callback called: false)
--- PASS: TestKafkaPublisherBacklogMonitoring (4.01s)
=== RUN   TestNATSPublisherBacklogMonitoring
    backlog_test.go:147: âœ… NATS publisher backlog monitoring test passed (callback called: false)
--- PASS: TestNATSPublisherBacklogMonitoring (4.01s)
=== RUN   TestKafkaStartAllBacklogMonitoring
    backlog_test.go:188: âœ… Kafka StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestKafkaStartAllBacklogMonitoring (4.01s)
=== RUN   TestNATSStartAllBacklogMonitoring
    backlog_test.go:231: âœ… NATS StartAllBacklogMonitoring test passed (sub: false, pub: false)
--- PASS: TestNATSStartAllBacklogMonitoring (4.01s)
=== RUN   TestKafkaSetMessageRouter
    backlog_test.go:250: âœ… Kafka SetMessageRouter test passed
--- PASS: TestKafkaSetMessageRouter (1.01s)
=== RUN   TestNATSSetMessageRouter
    backlog_test.go:269: âœ… NATS SetMessageRouter test passed
--- PASS: TestNATSSetMessageRouter (1.01s)
=== RUN   TestKafkaSetErrorHandler
    backlog_test.go:297: âœ… Kafka SetErrorHandler test passed
--- PASS: TestKafkaSetErrorHandler (1.01s)
=== RUN   TestKafkaBasicPublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.basic.1760421849318
    basic_test.go:34: ðŸ“¨ Received message: Hello Kafka!
    basic_test.go:53: âœ… Kafka basic publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.basic.1760421849318
--- PASS: TestKafkaBasicPublishSubscribe (10.45s)
=== RUN   TestNATSBasicPublishSubscribe
    basic_test.go:80: ðŸ“¨ Received message: Hello NATS!
    basic_test.go:99: âœ… NATS basic publish/subscribe test passed
--- PASS: TestNATSBasicPublishSubscribe (4.12s)
=== RUN   TestKafkaMultipleMessages
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multiple.1760421863884
    basic_test.go:137: âœ… Kafka multiple messages test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multiple.1760421863884
--- PASS: TestKafkaMultipleMessages (10.41s)
=== RUN   TestNATSMultipleMessages
    basic_test.go:176: âœ… NATS multiple messages test passed
--- PASS: TestNATSMultipleMessages (4.12s)
=== RUN   TestKafkaPublishWithOptions
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.options.1760421878414
    basic_test.go:215: âœ… Kafka PublishWithOptions test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.options.1760421878414
--- PASS: TestKafkaPublishWithOptions (10.62s)
=== RUN   TestNATSPublishWithOptions
    basic_test.go:255: âœ… NATS PublishWithOptions test passed
--- PASS: TestNATSPublishWithOptions (4.12s)
=== RUN   TestKafkaEnvelopePublishSubscribe
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.1760421893156
    envelope_test.go:33: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:61: âœ… Kafka Envelope publish/subscribe test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.1760421893156
--- PASS: TestKafkaEnvelopePublishSubscribe (10.41s)
=== RUN   TestNATSEnvelopePublishSubscribe
    envelope_test.go:84: ðŸ“¨ Received envelope: AggregateID=test-aggregate-1, EventType=TestEvent, Version=1
    envelope_test.go:112: âœ… NATS Envelope publish/subscribe test passed
--- PASS: TestNATSEnvelopePublishSubscribe (4.12s)
=== RUN   TestKafkaEnvelopeOrdering
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.envelope.order.1760421907678
    envelope_test.go:177: âœ… Kafka Envelope ordering test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.envelope.order.1760421907678
--- PASS: TestKafkaEnvelopeOrdering (10.54s)
=== RUN   TestNATSEnvelopeOrdering
    envelope_test.go:243: âœ… NATS Envelope ordering test passed
--- PASS: TestNATSEnvelopeOrdering (4.12s)
=== RUN   TestKafkaMultipleAggregates
    test_helper.go:235: âœ… Created Kafka topic: test.kafka.multi.agg.1760421922335
    envelope_test.go:293: âœ… Kafka multiple aggregates test passed
    test_helper.go:118: âœ… Deleted Kafka topic: test.kafka.multi.agg.1760421922335
--- PASS: TestKafkaMultipleAggregates (10.55s)
=== RUN   TestKafkaHealthCheckPublisher
    healthcheck_test.go:31: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:05:32.8931048 +0800 CST m=+110.699220701 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:37: âœ… Kafka health check publisher test passed
--- PASS: TestKafkaHealthCheckPublisher (4.01s)
=== RUN   TestNATSHealthCheckPublisher
    healthcheck_test.go:60: ðŸ“Š Health check publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:05:36.9019987 +0800 CST m=+114.708114601 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:66: âœ… NATS health check publisher test passed
--- PASS: TestNATSHealthCheckPublisher (4.01s)
=== RUN   TestKafkaHealthCheckSubscriber
    healthcheck_test.go:88: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:05:40.9148289 +0800 CST m=+118.720944801 LastMessageTime:2025-10-14 14:05:41.1318137 +0800 CST m=+118.937929601 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0009543}
    healthcheck_test.go:94: âœ… Kafka health check subscriber test passed
--- PASS: TestKafkaHealthCheckSubscriber (7.02s)
=== RUN   TestNATSHealthCheckSubscriber
    healthcheck_test.go:117: ðŸ“Š Health check subscriber stats: {StartTime:2025-10-14 14:05:47.9342439 +0800 CST m=+125.740359801 LastMessageTime:0001-01-01 00:00:00 +0000 UTC TotalMessagesReceived:0 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:false UptimeSeconds:3.0002854}
    healthcheck_test.go:123: âœ… NATS health check subscriber test passed
--- PASS: TestNATSHealthCheckSubscriber (4.01s)
=== RUN   TestKafkaStartAllHealthCheck
    healthcheck_test.go:146: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:05:51.941587 +0800 CST m=+129.747702901 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:147: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 14:05:51.9421346 +0800 CST m=+129.748250501 LastMessageTime:2025-10-14 14:05:52.1607121 +0800 CST m=+129.966828001 TotalMessagesReceived:2 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:6.0007458}
    healthcheck_test.go:153: âœ… Kafka StartAllHealthCheck test passed
--- PASS: TestKafkaStartAllHealthCheck (7.10s)
=== RUN   TestNATSStartAllHealthCheck
    healthcheck_test.go:177: ðŸ“Š Publisher status: {IsHealthy:true ConsecutiveFailures:0 LastSuccessTime:2025-10-14 14:05:59.0492856 +0800 CST m=+136.855401501 LastFailureTime:0001-01-01 00:00:00 +0000 UTC IsRunning:true EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:178: ðŸ“Š Subscriber stats: {StartTime:2025-10-14 14:05:59.0498169 +0800 CST m=+136.855932801 LastMessageTime:2025-10-14 14:05:59.0503526 +0800 CST m=+136.856468501 TotalMessagesReceived:1 ConsecutiveMisses:0 TotalAlerts:0 LastAlertTime:0001-01-01 00:00:00 +0000 UTC IsHealthy:true UptimeSeconds:3.0008669}
    healthcheck_test.go:184: âœ… NATS StartAllHealthCheck test passed
--- PASS: TestNATSStartAllHealthCheck (4.01s)
=== RUN   TestKafkaHealthCheckPublisherCallback
    healthcheck_test.go:205: ðŸ“ž Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:06:03.0593778 +0800 CST m=+140.865493701 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:kafka Source:kafka-eventbus}
    healthcheck_test.go:217: âœ… Kafka health check publisher callback test passed (callback called: true)
--- PASS: TestKafkaHealthCheckPublisherCallback (4.01s)
=== RUN   TestNATSHealthCheckPublisherCallback
    healthcheck_test.go:239: ðŸ“ž Health check publisher callback called: {Success:true Timestamp:2025-10-14 14:06:07.0701545 +0800 CST m=+144.876270401 Duration:0s Error:<nil> ConsecutiveFailures:0 EventBusType:nats Source:nats-eventbus}
    healthcheck_test.go:251: âœ… NATS health check publisher callback test passed (callback called: true)
--- PASS: TestNATSHealthCheckPublisherCallback (4.01s)
=== RUN   TestKafkaHealthCheckSubscriberCallback
    healthcheck_test.go:284: âœ… Kafka health check subscriber callback test passed (callback called: false)
--- PASS: TestKafkaHealthCheckSubscriberCallback (10.09s)
=== RUN   TestKafkaStartStop
    lifecycle_test.go:31: âœ… Kafka Start/Stop test passed
--- FAIL: TestKafkaStartStop (1.01s)
panic: close of closed channel [recovered]
	panic: close of closed channel

goroutine 9255 [running]:
testing.tRunner.func1.2({0x9b9400, 0xc3f4a0})
	C:/Program Files/Go/src/testing/testing.go:1734 +0x219
testing.tRunner.func1()
	C:/Program Files/Go/src/testing/testing.go:1737 +0x359
panic({0x9b9400?, 0xc3f4a0?})
	C:/Program Files/Go/src/runtime/panic.go:792 +0x132
github.com/ChenBigdata421/jxt-core/sdk/pkg/eventbus.(*KeyedWorkerPool).Stop(...)
	D:/JXT/jxt-evidence-system/jxt-core/sdk/pkg/eventbus/keyed_worker_pool.go:147
github.com/ChenBigdata421/jxt-core/sdk/pkg/eventbus.(*kafkaEventBus).Close(0xc000790788)
	D:/JXT/jxt-evidence-system/jxt-core/sdk/pkg/eventbus/kafka.go:1519 +0x9b
github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests.(*TestHelper).CloseEventBus(0xc0004b7ed0, {0xc5f0b0, 0xc000790788})
	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/function_tests/test_helper.go:272 +0xbd
github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests.TestKafkaStartStop(0xc000ff3500)
	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/function_tests/lifecycle_test.go:32 +0x304
testing.tRunner(0xc000ff3500, 0xb433c0)
	C:/Program Files/Go/src/testing/testing.go:1792 +0xcb
created by testing.(*T).Run in goroutine 1
	C:/Program Files/Go/src/testing/testing.go:1851 +0x3f6
FAIL	github.com/ChenBigdata421/jxt-core/tests/eventbus/function_tests	160.475s
FAIL
