=== RUN   TestKafkaVsNATSPerformanceComparison
    kafka_nats_comparison_test.go:258: 🚀 ===== Kafka vs NATS JetStream 全面性能对比测试 =====
    kafka_nats_comparison_test.go:259: 📋 测试要求:
    kafka_nats_comparison_test.go:260:    1. 创建 EventBus 实例（Kafka 和 NATS JetStream）
    kafka_nats_comparison_test.go:261:    2. NATS JetStream 持久化到磁盘
    kafka_nats_comparison_test.go:262:    3. 使用 PublishEnvelope 方法发布
    kafka_nats_comparison_test.go:263:    4. 使用 SubscribeEnvelope 方法订阅
    kafka_nats_comparison_test.go:264:    5. 测试压力：低压500、中压2000、高压5000、极限10000
    kafka_nats_comparison_test.go:265:    6. Topic 数量：5
    kafka_nats_comparison_test.go:266:    7. 统计连接数和消费者组个数
    kafka_nats_comparison_test.go:267:    8. 仅使用 ASCII 字符命名
    kafka_nats_comparison_test.go:268: 
    kafka_nats_comparison_test.go:289: 
        ================================================================================
    kafka_nats_comparison_test.go:290: 🎯 开始 低压 测试 (500 条消息)
    kafka_nats_comparison_test.go:291: ================================================================================
    kafka_nats_comparison_test.go:227: 
        🔄 准备测试环境: 低压
    kafka_nats_comparison_test.go:135: 🧹 清理 Kafka 测试数据 (topic prefix: kafka.perf)...
    kafka_nats_comparison_test.go:171: ⚠️  删除 topic kafka.perf.extreme.topic2 失败: kafka server: Request was for a topic or partition that does not exist on this broker
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.extreme.topic3
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.extreme.topic1
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.extreme.topic5
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.extreme.topic4
    kafka_nats_comparison_test.go:176: ✅ 成功删除 5 个 Kafka topics
    kafka_nats_comparison_test.go:184: 🧹 清理 NATS JetStream 测试数据 (stream prefix: PERF_)...
    kafka_nats_comparison_test.go:212:    ✅ 已删除 stream: PERF_extreme_1760284689
    kafka_nats_comparison_test.go:219: ✅ 成功删除 1 个 NATS streams
    kafka_nats_comparison_test.go:239: ✅ 测试环境准备完成
    kafka_nats_comparison_test.go:297: 
        🔴 测试 Kafka...
2025-10-13T00:12:27.545+0800	INFO	logger/logger.go:48	Kafka EventBus created successfully (AsyncProducer mode)brokers[localhost:29094]clientIdkafka-perf-low-1760285547healthCheckInterval30scompressionsnappyflushFrequency10msflushMessages100flushBytes1048576
    kafka_nats_comparison_test.go:414: ✅ 已设置预订阅 topic 列表: [kafka.perf.low.topic1 kafka.perf.low.topic2 kafka.perf.low.topic3 kafka.perf.low.topic4 kafka.perf.low.topic5]
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 500/500 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:302: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:307: 
        🔵 测试 NATS JetStream (磁盘持久化)...
2025-10-13T00:12:58.806+0800	INFO	logger/logger.go:48	NATS EventBus created successfullyurls[nats://localhost:4223]clientIdnats-perf-low-1760285578
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 500/500 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:897: 
        ================================================================================
    kafka_nats_comparison_test.go:898: 📊 低压 测试结果对比
    kafka_nats_comparison_test.go:899: ================================================================================
    kafka_nats_comparison_test.go:902: 
        📨 消息统计:
    kafka_nats_comparison_test.go:903:    发送消息数                | Kafka:      500 | NATS:      500
    kafka_nats_comparison_test.go:904:    接收消息数                | Kafka:      500 | NATS:      995
    kafka_nats_comparison_test.go:905:    成功率                  | Kafka:  100.00% | NATS:  199.00%
    kafka_nats_comparison_test.go:906:    发送错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:907:    处理错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:908:    顺序违反                 | Kafka:       15 | NATS:      623
    kafka_nats_comparison_test.go:911: 
        🚀 性能指标:
    kafka_nats_comparison_test.go:912:    发送吞吐量                | Kafka:      33.33 msg/s | NATS:      33.06 msg/s
    kafka_nats_comparison_test.go:913:    接收吞吐量                | Kafka:      33.33 msg/s | NATS:      65.79 msg/s
    kafka_nats_comparison_test.go:914:    平均发送延迟               | Kafka:      0.019 ms | NATS:      1.202 ms
    kafka_nats_comparison_test.go:915:    平均处理延迟               | Kafka:      0.012 ms | NATS:      0.005 ms
    kafka_nats_comparison_test.go:916:    总耗时                  | Kafka:      15.00 s | NATS:      15.12 s
    kafka_nats_comparison_test.go:919: 
        💾 资源占用:
    kafka_nats_comparison_test.go:920:    初始协程数                | Kafka:        3 | NATS:        3
    kafka_nats_comparison_test.go:921:    峰值协程数                | Kafka:      369 | NATS:     5530
    kafka_nats_comparison_test.go:922:    最终协程数                | Kafka:      369 | NATS:     5522
    kafka_nats_comparison_test.go:923:    协程泄漏                 | Kafka:      366 | NATS:     5519
    kafka_nats_comparison_test.go:924:    初始内存                 | Kafka:       1.50 MB | NATS:       1.69 MB
    kafka_nats_comparison_test.go:925:    峰值内存                 | Kafka:       6.48 MB | NATS:      67.74 MB
    kafka_nats_comparison_test.go:926:    最终内存                 | Kafka:       6.28 MB | NATS:      67.74 MB
    kafka_nats_comparison_test.go:927:    内存增量                 | Kafka:       4.78 MB | NATS:      66.05 MB
    kafka_nats_comparison_test.go:930: 
        🔗 连接和消费者组:
    kafka_nats_comparison_test.go:931:    Topic 数量             | Kafka:        5 | NATS:        5
    kafka_nats_comparison_test.go:932:    连接数                  | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:933:    消费者组个数               | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:935:    Kafka Topics: [kafka.perf.low.topic1 kafka.perf.low.topic2 kafka.perf.low.topic3 kafka.perf.low.topic4 kafka.perf.low.topic5]
    kafka_nats_comparison_test.go:938:    NATS Topics: [nats.perf.low.1760285578.topic1 nats.perf.low.1760285578.topic2 nats.perf.low.1760285578.topic3 nats.perf.low.1760285578.topic4 nats.perf.low.1760285578.topic5]
    kafka_nats_comparison_test.go:942: 
        🏆 性能优势:
    kafka_nats_comparison_test.go:948:    NATS 吞吐量优势: +97.42%
    kafka_nats_comparison_test.go:956:    NATS 延迟优势: -63.53%
    kafka_nats_comparison_test.go:961:    Kafka 内存优势: -92.76%
    kafka_nats_comparison_test.go:967: ================================================================================
    kafka_nats_comparison_test.go:972: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:972
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 15
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	Kafka 不应该有顺序违反
    kafka_nats_comparison_test.go:973: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:973
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 623
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 不应该有顺序违反
    kafka_nats_comparison_test.go:315: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:289: 
        ================================================================================
    kafka_nats_comparison_test.go:290: 🎯 开始 中压 测试 (2000 条消息)
    kafka_nats_comparison_test.go:291: ================================================================================
    kafka_nats_comparison_test.go:227: 
        🔄 准备测试环境: 中压
    kafka_nats_comparison_test.go:135: 🧹 清理 Kafka 测试数据 (topic prefix: kafka.perf)...
    kafka_nats_comparison_test.go:171: ⚠️  删除 topic kafka.perf.low.topic3 失败: kafka server: Request was for a topic or partition that does not exist on this broker
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.low.topic4
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.low.topic1
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.low.topic2
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.low.topic5
    kafka_nats_comparison_test.go:176: ✅ 成功删除 5 个 Kafka topics
    kafka_nats_comparison_test.go:184: 🧹 清理 NATS JetStream 测试数据 (stream prefix: PERF_)...
    kafka_nats_comparison_test.go:212:    ✅ 已删除 stream: PERF_low_1760285578
    kafka_nats_comparison_test.go:219: ✅ 成功删除 1 个 NATS streams
    kafka_nats_comparison_test.go:239: ✅ 测试环境准备完成
    kafka_nats_comparison_test.go:297: 
        🔴 测试 Kafka...
2025-10-13T00:13:28.052+0800	INFO	logger/logger.go:48	Kafka EventBus created successfully (AsyncProducer mode)brokers[localhost:29094]clientIdkafka-perf-medium-1760285608healthCheckInterval30scompressionsnappyflushFrequency10msflushMessages100flushBytes1048576
    kafka_nats_comparison_test.go:414: ✅ 已设置预订阅 topic 列表: [kafka.perf.medium.topic1 kafka.perf.medium.topic2 kafka.perf.medium.topic3 kafka.perf.medium.topic4 kafka.perf.medium.topic5]
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 2000/2000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:302: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:307: 
        🔵 测试 NATS JetStream (磁盘持久化)...
2025-10-13T00:13:59.294+0800	INFO	logger/logger.go:48	NATS EventBus created successfullyurls[nats://localhost:4223]clientIdnats-perf-medium-1760285639
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 2000/2000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:897: 
        ================================================================================
    kafka_nats_comparison_test.go:898: 📊 中压 测试结果对比
    kafka_nats_comparison_test.go:899: ================================================================================
    kafka_nats_comparison_test.go:902: 
        📨 消息统计:
    kafka_nats_comparison_test.go:903:    发送消息数                | Kafka:     2000 | NATS:     2000
    kafka_nats_comparison_test.go:904:    接收消息数                | Kafka:     2000 | NATS:     2000
    kafka_nats_comparison_test.go:905:    成功率                  | Kafka:  100.00% | NATS:  100.00%
    kafka_nats_comparison_test.go:906:    发送错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:907:    处理错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:908:    顺序违反                 | Kafka:       14 | NATS:     1581
    kafka_nats_comparison_test.go:911: 
        🚀 性能指标:
    kafka_nats_comparison_test.go:912:    发送吞吐量                | Kafka:     133.22 msg/s | NATS:     131.77 msg/s
    kafka_nats_comparison_test.go:913:    接收吞吐量                | Kafka:     133.22 msg/s | NATS:     131.77 msg/s
    kafka_nats_comparison_test.go:914:    平均发送延迟               | Kafka:      0.094 ms | NATS:      1.718 ms
    kafka_nats_comparison_test.go:915:    平均处理延迟               | Kafka:      0.002 ms | NATS:      0.008 ms
    kafka_nats_comparison_test.go:916:    总耗时                  | Kafka:      15.01 s | NATS:      15.18 s
    kafka_nats_comparison_test.go:919: 
        💾 资源占用:
    kafka_nats_comparison_test.go:920:    初始协程数                | Kafka:        3 | NATS:        3
    kafka_nats_comparison_test.go:921:    峰值协程数                | Kafka:      369 | NATS:     5544
    kafka_nats_comparison_test.go:922:    最终协程数                | Kafka:      369 | NATS:     5522
    kafka_nats_comparison_test.go:923:    协程泄漏                 | Kafka:      366 | NATS:     5519
    kafka_nats_comparison_test.go:924:    初始内存                 | Kafka:       4.28 MB | NATS:       4.28 MB
    kafka_nats_comparison_test.go:925:    峰值内存                 | Kafka:      14.74 MB | NATS:      63.38 MB
    kafka_nats_comparison_test.go:926:    最终内存                 | Kafka:      14.92 MB | NATS:      62.51 MB
    kafka_nats_comparison_test.go:927:    内存增量                 | Kafka:      10.64 MB | NATS:      58.24 MB
    kafka_nats_comparison_test.go:930: 
        🔗 连接和消费者组:
    kafka_nats_comparison_test.go:931:    Topic 数量             | Kafka:        5 | NATS:        5
    kafka_nats_comparison_test.go:932:    连接数                  | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:933:    消费者组个数               | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:935:    Kafka Topics: [kafka.perf.medium.topic1 kafka.perf.medium.topic2 kafka.perf.medium.topic3 kafka.perf.medium.topic4 kafka.perf.medium.topic5]
    kafka_nats_comparison_test.go:938:    NATS Topics: [nats.perf.medium.1760285639.topic1 nats.perf.medium.1760285639.topic2 nats.perf.medium.1760285639.topic3 nats.perf.medium.1760285639.topic4 nats.perf.medium.1760285639.topic5]
    kafka_nats_comparison_test.go:942: 
        🏆 性能优势:
    kafka_nats_comparison_test.go:945:    Kafka 吞吐量优势: +1.10%
    kafka_nats_comparison_test.go:953:    Kafka 延迟优势: -78.04%
    kafka_nats_comparison_test.go:961:    Kafka 内存优势: -81.73%
    kafka_nats_comparison_test.go:967: ================================================================================
    kafka_nats_comparison_test.go:972: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:972
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 14
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	Kafka 不应该有顺序违反
    kafka_nats_comparison_test.go:973: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:973
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 1581
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 不应该有顺序违反
    kafka_nats_comparison_test.go:315: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:289: 
        ================================================================================
    kafka_nats_comparison_test.go:290: 🎯 开始 高压 测试 (5000 条消息)
    kafka_nats_comparison_test.go:291: ================================================================================
    kafka_nats_comparison_test.go:227: 
        🔄 准备测试环境: 高压
    kafka_nats_comparison_test.go:135: 🧹 清理 Kafka 测试数据 (topic prefix: kafka.perf)...
    kafka_nats_comparison_test.go:171: ⚠️  删除 topic kafka.perf.medium.topic2 失败: kafka server: Request was for a topic or partition that does not exist on this broker
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.medium.topic5
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.medium.topic4
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.medium.topic3
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.medium.topic1
    kafka_nats_comparison_test.go:176: ✅ 成功删除 5 个 Kafka topics
    kafka_nats_comparison_test.go:184: 🧹 清理 NATS JetStream 测试数据 (stream prefix: PERF_)...
    kafka_nats_comparison_test.go:212:    ✅ 已删除 stream: PERF_medium_1760285639
    kafka_nats_comparison_test.go:219: ✅ 成功删除 1 个 NATS streams
    kafka_nats_comparison_test.go:239: ✅ 测试环境准备完成
    kafka_nats_comparison_test.go:297: 
        🔴 测试 Kafka...
2025-10-13T00:14:28.584+0800	INFO	logger/logger.go:48	Kafka EventBus created successfully (AsyncProducer mode)brokers[localhost:29094]clientIdkafka-perf-high-1760285668healthCheckInterval30scompressionsnappyflushFrequency10msflushMessages100flushBytes1048576
    kafka_nats_comparison_test.go:414: ✅ 已设置预订阅 topic 列表: [kafka.perf.high.topic1 kafka.perf.high.topic2 kafka.perf.high.topic3 kafka.perf.high.topic4 kafka.perf.high.topic5]
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 5000/5000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:302: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:307: 
        🔵 测试 NATS JetStream (磁盘持久化)...
2025-10-13T00:15:15.051+0800	INFO	logger/logger.go:48	NATS EventBus created successfullyurls[nats://localhost:4223]clientIdnats-perf-high-1760285715
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 5000/5000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:897: 
        ================================================================================
    kafka_nats_comparison_test.go:898: 📊 高压 测试结果对比
    kafka_nats_comparison_test.go:899: ================================================================================
    kafka_nats_comparison_test.go:902: 
        📨 消息统计:
    kafka_nats_comparison_test.go:903:    发送消息数                | Kafka:     5000 | NATS:     5000
    kafka_nats_comparison_test.go:904:    接收消息数                | Kafka:     5000 | NATS:     3000
    kafka_nats_comparison_test.go:905:    成功率                  | Kafka:  100.00% | NATS:   60.00%
    kafka_nats_comparison_test.go:906:    发送错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:907:    处理错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:908:    顺序违反                 | Kafka:      153 | NATS:     2446
    kafka_nats_comparison_test.go:911: 
        🚀 性能指标:
    kafka_nats_comparison_test.go:912:    发送吞吐量                | Kafka:     166.58 msg/s | NATS:     165.37 msg/s
    kafka_nats_comparison_test.go:913:    接收吞吐量                | Kafka:     166.58 msg/s | NATS:      99.22 msg/s
    kafka_nats_comparison_test.go:914:    平均发送延迟               | Kafka:      0.142 ms | NATS:      2.282 ms
    kafka_nats_comparison_test.go:915:    平均处理延迟               | Kafka:      0.003 ms | NATS:      0.005 ms
    kafka_nats_comparison_test.go:916:    总耗时                  | Kafka:      30.02 s | NATS:      30.24 s
    kafka_nats_comparison_test.go:919: 
        💾 资源占用:
    kafka_nats_comparison_test.go:920:    初始协程数                | Kafka:        3 | NATS:        3
    kafka_nats_comparison_test.go:921:    峰值协程数                | Kafka:      369 | NATS:     5573
    kafka_nats_comparison_test.go:922:    最终协程数                | Kafka:      369 | NATS:     5522
    kafka_nats_comparison_test.go:923:    协程泄漏                 | Kafka:      366 | NATS:     5519
    kafka_nats_comparison_test.go:924:    初始内存                 | Kafka:       4.64 MB | NATS:       4.62 MB
    kafka_nats_comparison_test.go:925:    峰值内存                 | Kafka:      19.09 MB | NATS:      81.50 MB
    kafka_nats_comparison_test.go:926:    最终内存                 | Kafka:       8.18 MB | NATS:      81.50 MB
    kafka_nats_comparison_test.go:927:    内存增量                 | Kafka:       3.54 MB | NATS:      76.88 MB
    kafka_nats_comparison_test.go:930: 
        🔗 连接和消费者组:
    kafka_nats_comparison_test.go:931:    Topic 数量             | Kafka:        5 | NATS:        5
    kafka_nats_comparison_test.go:932:    连接数                  | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:933:    消费者组个数               | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:935:    Kafka Topics: [kafka.perf.high.topic1 kafka.perf.high.topic2 kafka.perf.high.topic3 kafka.perf.high.topic4 kafka.perf.high.topic5]
    kafka_nats_comparison_test.go:938:    NATS Topics: [nats.perf.high.1760285715.topic1 nats.perf.high.1760285715.topic2 nats.perf.high.1760285715.topic3 nats.perf.high.1760285715.topic4 nats.perf.high.1760285715.topic5]
    kafka_nats_comparison_test.go:942: 
        🏆 性能优势:
    kafka_nats_comparison_test.go:945:    Kafka 吞吐量优势: +67.89%
    kafka_nats_comparison_test.go:953:    Kafka 延迟优势: -42.75%
    kafka_nats_comparison_test.go:961:    Kafka 内存优势: -95.39%
    kafka_nats_comparison_test.go:967: ================================================================================
    kafka_nats_comparison_test.go:971: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:971
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	"60" is not greater than "90"
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 成功率应该 > 90%
    kafka_nats_comparison_test.go:972: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:972
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 153
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	Kafka 不应该有顺序违反
    kafka_nats_comparison_test.go:973: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:973
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 2446
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 不应该有顺序违反
    kafka_nats_comparison_test.go:315: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:289: 
        ================================================================================
    kafka_nats_comparison_test.go:290: 🎯 开始 极限 测试 (10000 条消息)
    kafka_nats_comparison_test.go:291: ================================================================================
    kafka_nats_comparison_test.go:227: 
        🔄 准备测试环境: 极限
    kafka_nats_comparison_test.go:135: 🧹 清理 Kafka 测试数据 (topic prefix: kafka.perf)...
    kafka_nats_comparison_test.go:171: ⚠️  删除 topic kafka.perf.high.topic1 失败: kafka server: Request was for a topic or partition that does not exist on this broker
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.high.topic3
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.high.topic4
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.high.topic5
    kafka_nats_comparison_test.go:173:    ✅ 已删除 topic: kafka.perf.high.topic2
    kafka_nats_comparison_test.go:176: ✅ 成功删除 5 个 Kafka topics
    kafka_nats_comparison_test.go:184: 🧹 清理 NATS JetStream 测试数据 (stream prefix: PERF_)...
    kafka_nats_comparison_test.go:212:    ✅ 已删除 stream: PERF_high_1760285715
    kafka_nats_comparison_test.go:219: ✅ 成功删除 1 个 NATS streams
    kafka_nats_comparison_test.go:239: ✅ 测试环境准备完成
    kafka_nats_comparison_test.go:297: 
        🔴 测试 Kafka...
2025-10-13T00:15:59.407+0800	INFO	logger/logger.go:48	Kafka EventBus created successfully (AsyncProducer mode)brokers[localhost:29094]clientIdkafka-perf-extreme-1760285759healthCheckInterval30scompressionsnappyflushFrequency10msflushMessages100flushBytes1048576
    kafka_nats_comparison_test.go:414: ✅ 已设置预订阅 topic 列表: [kafka.perf.extreme.topic1 kafka.perf.extreme.topic2 kafka.perf.extreme.topic3 kafka.perf.extreme.topic4 kafka.perf.extreme.topic5]
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 10000/10000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:302: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:307: 
        🔵 测试 NATS JetStream (磁盘持久化)...
2025-10-13T00:16:45.897+0800	INFO	logger/logger.go:48	NATS EventBus created successfullyurls[nats://localhost:4223]clientIdnats-perf-extreme-1760285805
    kafka_nats_comparison_test.go:660: ✅ 发送完成: 10000/10000 条消息
    kafka_nats_comparison_test.go:663: ⏳ 等待消息处理完成...
    kafka_nats_comparison_test.go:897: 
        ================================================================================
    kafka_nats_comparison_test.go:898: 📊 极限 测试结果对比
    kafka_nats_comparison_test.go:899: ================================================================================
    kafka_nats_comparison_test.go:902: 
        📨 消息统计:
    kafka_nats_comparison_test.go:903:    发送消息数                | Kafka:    10000 | NATS:    10000
    kafka_nats_comparison_test.go:904:    接收消息数                | Kafka:    10000 | NATS:     3000
    kafka_nats_comparison_test.go:905:    成功率                  | Kafka:  100.00% | NATS:   30.00%
    kafka_nats_comparison_test.go:906:    发送错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:907:    处理错误                 | Kafka:        0 | NATS:        0
    kafka_nats_comparison_test.go:908:    顺序违反                 | Kafka:      196 | NATS:     2482
    kafka_nats_comparison_test.go:911: 
        🚀 性能指标:
    kafka_nats_comparison_test.go:912:    发送吞吐量                | Kafka:     333.00 msg/s | NATS:     330.36 msg/s
    kafka_nats_comparison_test.go:913:    接收吞吐量                | Kafka:     333.00 msg/s | NATS:      99.11 msg/s
    kafka_nats_comparison_test.go:914:    平均发送延迟               | Kafka:      0.279 ms | NATS:      2.643 ms
    kafka_nats_comparison_test.go:915:    平均处理延迟               | Kafka:      0.005 ms | NATS:      0.006 ms
    kafka_nats_comparison_test.go:916:    总耗时                  | Kafka:      30.03 s | NATS:      30.27 s
    kafka_nats_comparison_test.go:919: 
        💾 资源占用:
    kafka_nats_comparison_test.go:920:    初始协程数                | Kafka:        3 | NATS:        3
    kafka_nats_comparison_test.go:921:    峰值协程数                | Kafka:      369 | NATS:     5624
    kafka_nats_comparison_test.go:922:    最终协程数                | Kafka:      369 | NATS:     5522
    kafka_nats_comparison_test.go:923:    协程泄漏                 | Kafka:      366 | NATS:     5519
    kafka_nats_comparison_test.go:924:    初始内存                 | Kafka:       4.68 MB | NATS:       4.66 MB
    kafka_nats_comparison_test.go:925:    峰值内存                 | Kafka:      20.12 MB | NATS:      91.40 MB
    kafka_nats_comparison_test.go:926:    最终内存                 | Kafka:      14.18 MB | NATS:      91.43 MB
    kafka_nats_comparison_test.go:927:    内存增量                 | Kafka:       9.50 MB | NATS:      86.77 MB
    kafka_nats_comparison_test.go:930: 
        🔗 连接和消费者组:
    kafka_nats_comparison_test.go:931:    Topic 数量             | Kafka:        5 | NATS:        5
    kafka_nats_comparison_test.go:932:    连接数                  | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:933:    消费者组个数               | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:935:    Kafka Topics: [kafka.perf.extreme.topic1 kafka.perf.extreme.topic2 kafka.perf.extreme.topic3 kafka.perf.extreme.topic4 kafka.perf.extreme.topic5]
    kafka_nats_comparison_test.go:938:    NATS Topics: [nats.perf.extreme.1760285805.topic1 nats.perf.extreme.1760285805.topic2 nats.perf.extreme.1760285805.topic3 nats.perf.extreme.1760285805.topic4 nats.perf.extreme.1760285805.topic5]
    kafka_nats_comparison_test.go:942: 
        🏆 性能优势:
    kafka_nats_comparison_test.go:945:    Kafka 吞吐量优势: +235.99%
    kafka_nats_comparison_test.go:953:    Kafka 延迟优势: -18.32%
    kafka_nats_comparison_test.go:961:    Kafka 内存优势: -89.05%
    kafka_nats_comparison_test.go:967: ================================================================================
    kafka_nats_comparison_test.go:971: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:971
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	"30" is not greater than "90"
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 成功率应该 > 90%
    kafka_nats_comparison_test.go:972: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:972
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 196
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	Kafka 不应该有顺序违反
    kafka_nats_comparison_test.go:973: 
        	Error Trace:	D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:973
        	            				D:/JXT/jxt-evidence-system/jxt-core/tests/eventbus/performance_tests/kafka_nats_comparison_test.go:312
        	Error:      	Not equal: 
        	            	expected: 0
        	            	actual  : 2482
        	Test:       	TestKafkaVsNATSPerformanceComparison
        	Messages:   	NATS 不应该有顺序违反
    kafka_nats_comparison_test.go:315: ⏳ 等待资源释放...
    kafka_nats_comparison_test.go:978: 
        ====================================================================================================
    kafka_nats_comparison_test.go:979: 🏆 Kafka vs NATS JetStream 综合性能对比报告
    kafka_nats_comparison_test.go:980: ====================================================================================================
    kafka_nats_comparison_test.go:991: 
        📊 性能指标汇总表:
    kafka_nats_comparison_test.go:992: 压力级别       | 系统              | 吞吐量(msg/s)      | 延迟(ms)          | 成功率(%)          | 内存增量(MB)        | 协程泄漏           
    kafka_nats_comparison_test.go:994: ----------------------------------------------------------------------------------------------------
    kafka_nats_comparison_test.go:1000: 低压         | Kafka           |           33.33 |           0.012 |          100.00 |            4.78 |             366
    kafka_nats_comparison_test.go:1003: 低压         | NATS            |           65.79 |           0.005 |          199.00 |           66.05 |            5519
    kafka_nats_comparison_test.go:1006: ----------------------------------------------------------------------------------------------------
    kafka_nats_comparison_test.go:1000: 中压         | Kafka           |          133.22 |           0.002 |          100.00 |           10.64 |             366
    kafka_nats_comparison_test.go:1003: 中压         | NATS            |          131.77 |           0.008 |          100.00 |           58.24 |            5519
    kafka_nats_comparison_test.go:1006: ----------------------------------------------------------------------------------------------------
    kafka_nats_comparison_test.go:1000: 高压         | Kafka           |          166.58 |           0.003 |          100.00 |            3.54 |             366
    kafka_nats_comparison_test.go:1003: 高压         | NATS            |           99.22 |           0.005 |           60.00 |           76.88 |            5519
    kafka_nats_comparison_test.go:1006: ----------------------------------------------------------------------------------------------------
    kafka_nats_comparison_test.go:1000: 极限         | Kafka           |          333.00 |           0.005 |          100.00 |            9.50 |             366
    kafka_nats_comparison_test.go:1003: 极限         | NATS            |           99.11 |           0.006 |           30.00 |           86.77 |            5519
    kafka_nats_comparison_test.go:1006: ----------------------------------------------------------------------------------------------------
    kafka_nats_comparison_test.go:1032: 
        🎯 综合评分:
    kafka_nats_comparison_test.go:1033: 平均吞吐量                | Kafka:     166.53 msg/s | NATS:      98.97 msg/s
    kafka_nats_comparison_test.go:1034: 平均延迟                 | Kafka:      0.005 ms | NATS:      0.006 ms
    kafka_nats_comparison_test.go:1035: 平均内存增量               | Kafka:       7.12 MB | NATS:      71.98 MB
    kafka_nats_comparison_test.go:1039: 
        🔗 连接和消费者组统计:
    kafka_nats_comparison_test.go:1040: Topic 数量             | Kafka:        5 | NATS:        5
    kafka_nats_comparison_test.go:1041: 连接数                  | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:1042: 消费者组个数               | Kafka:        1 | NATS:        1
    kafka_nats_comparison_test.go:1046: 
        🏆 最终结论:
    kafka_nats_comparison_test.go:1053:    ✅ 吞吐量: Kafka 胜出 (+68.26%)
    kafka_nats_comparison_test.go:1063:    ✅ 延迟: Kafka 胜出 (-7.30%)
    kafka_nats_comparison_test.go:1073:    ✅ 内存效率: Kafka 胜出 (-90.11%)
    kafka_nats_comparison_test.go:1081: 
        🎉 总体获胜者:
    kafka_nats_comparison_test.go:1083:    🥇 Kafka 以 3:0 获胜！
    kafka_nats_comparison_test.go:1091: 
        💡 使用建议:
    kafka_nats_comparison_test.go:1092: 🔴 选择 Kafka 当:
    kafka_nats_comparison_test.go:1093:    • 需要企业级可靠性和持久化保证
    kafka_nats_comparison_test.go:1094:    • 需要复杂的数据处理管道
    kafka_nats_comparison_test.go:1095:    • 需要成熟的生态系统和工具链
    kafka_nats_comparison_test.go:1096:    • 数据量大且需要长期保存
    kafka_nats_comparison_test.go:1098: 
        🔵 选择 NATS JetStream 当:
    kafka_nats_comparison_test.go:1099:    • 需要极致的性能和低延迟
    kafka_nats_comparison_test.go:1100:    • 需要简单的部署和运维
    kafka_nats_comparison_test.go:1101:    • 需要轻量级的消息传递
    kafka_nats_comparison_test.go:1102:    • 构建实时应用和微服务
    kafka_nats_comparison_test.go:1104: 
        ====================================================================================================
    kafka_nats_comparison_test.go:1105: ✅ 测试完成！共执行 4 个场景，8 次测试
    kafka_nats_comparison_test.go:1106: ====================================================================================================
--- FAIL: TestKafkaVsNATSPerformanceComparison (302.73s)
FAIL
exit status 1
FAIL	github.com/ChenBigdata421/jxt-core/tests/eventbus/performance_tests	303.484s
