=== RUN   TestMemoryPersistenceComparison
    memory_persistence_comparison_test.go:883: 
        ====================================================================================================
    memory_persistence_comparison_test.go:884: 🎯 Kafka vs NATS JetStream 内存持久化性能对比测试
    memory_persistence_comparison_test.go:885: ====================================================================================================
    memory_persistence_comparison_test.go:907: 
        ====================================================================================================
    memory_persistence_comparison_test.go:908: 🚀 开始测试场景: Low 压力 (500 消息, 5 topics)
    memory_persistence_comparison_test.go:909: ====================================================================================================
    memory_persistence_comparison_test.go:285: 
        ================================================================================
    memory_persistence_comparison_test.go:286: 🔵 测试 Kafka - Low 压力 (500 消息, 5 topics)
    memory_persistence_comparison_test.go:287: ================================================================================
    memory_persistence_comparison_test.go:91: 🧹 清理 Kafka 测试数据 (topic prefix: test.memory.kafka)...
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic1
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic2
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic4
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic3
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic5
    memory_persistence_comparison_test.go:125: ✅ 成功删除 5 个 Kafka topics
    memory_persistence_comparison_test.go:171: 🔧 创建 Kafka Topics (3 分区)...
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic1 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic2 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic3 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic4 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic5 (3 partitions)
    memory_persistence_comparison_test.go:212: 📊 验证创建的 Topics:
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:228: ✅ 成功创建 5 个 Kafka topics
    memory_persistence_comparison_test.go:382: 📊 初始资源: Goroutines=314, Memory=4.22 MB
    memory_persistence_comparison_test.go:391: ✅ 已设置预订阅 topic 列表: [test.memory.kafka.topic1 test.memory.kafka.topic2 test.memory.kafka.topic3 test.memory.kafka.topic4 test.memory.kafka.topic5]
    memory_persistence_comparison_test.go:423: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:427: 📤 开始发送 500 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:479: ✅ 发送完成
    memory_persistence_comparison_test.go:482: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:495: ✅ 接收完成: 500/500
    memory_persistence_comparison_test.go:370: 📊 Kafka 资源清理完成: 初始 314 -> 最终 448 (泄漏 134)
    memory_persistence_comparison_test.go:516: 
        ================================================================================
    memory_persistence_comparison_test.go:517: 🟢 测试 NATS - Low 压力 (500 消息, 5 topics)
    memory_persistence_comparison_test.go:518: ================================================================================
    memory_persistence_comparison_test.go:133: 🧹 清理 NATS 测试数据 (stream prefix: TEST_MEMORY_NATS)...
    memory_persistence_comparison_test.go:156:    ✅ 已删除 stream: TEST_MEMORY_NATS
    memory_persistence_comparison_test.go:163: ✅ 成功删除 1 个 NATS streams
    memory_persistence_comparison_test.go:625: 📊 初始资源: Goroutines=265, Memory=4.13 MB
    memory_persistence_comparison_test.go:657: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:661: 📤 开始发送 500 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:713: ✅ 发送完成
    memory_persistence_comparison_test.go:716: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:729: ✅ 接收完成: 500/500
    memory_persistence_comparison_test.go:595: 📊 NATS 资源清理完成: 初始 265 -> 最终 275 (泄漏 10)
    memory_persistence_comparison_test.go:750: 
        ====================================================================================================
    memory_persistence_comparison_test.go:751: 📊 Kafka vs NATS JetStream 内存持久化性能对比报告 - Low 压力
    memory_persistence_comparison_test.go:752: ====================================================================================================
    memory_persistence_comparison_test.go:755: 
        📋 基本信息:
    memory_persistence_comparison_test.go:756:   压力级别: Low
    memory_persistence_comparison_test.go:757:   消息总数: 500
    memory_persistence_comparison_test.go:758:   Topic 数量: 5
    memory_persistence_comparison_test.go:759:   Kafka 分区数: 3 (每个 topic)
    memory_persistence_comparison_test.go:763: 
        📊 Kafka 分区详情:
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:770: 
        📨 消息指标对比:
    memory_persistence_comparison_test.go:771:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:773:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:774:   发送消息数                | 500             | 500             | +0.0%
    memory_persistence_comparison_test.go:777:   接收消息数                | 500             | 500             | +0.0%
    memory_persistence_comparison_test.go:780:   发送错误数                | 0               | 0               | -
    memory_persistence_comparison_test.go:782:   成功率                  | 100.00         % | 100.00         % | +0.0%
    memory_persistence_comparison_test.go:787: 
        ⚡ 性能指标对比:
    memory_persistence_comparison_test.go:788:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:789:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:790:   发送吞吐量 (msg/s)        | 493.45          | 143.53          | -70.9%
    memory_persistence_comparison_test.go:793:   接收吞吐量 (msg/s)        | 493.45          | 143.53          | -70.9%
    memory_persistence_comparison_test.go:796:   平均发送延迟 (ms)          | 0.031           | 24.110          | +76937.3%
    memory_persistence_comparison_test.go:799:   平均处理延迟 (ms)          | 136.811         | 33.678          | -75.4%
    memory_persistence_comparison_test.go:802:   测试时长 (s)             | 1.01            | 3.48            | -
    memory_persistence_comparison_test.go:806: 
        💾 资源占用对比:
    memory_persistence_comparison_test.go:807:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:808:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:809:   初始协程数                | 314             | 265             | -49
    memory_persistence_comparison_test.go:812:   峰值协程数                | 453             | 281             | -172
    memory_persistence_comparison_test.go:815:   最终协程数                | 448             | 275             | -173
    memory_persistence_comparison_test.go:818:   协程泄漏数                | 134             | 10              | -
    memory_persistence_comparison_test.go:820:   初始内存 (MB)            | 4.22            | 4.13            | -0.09
    memory_persistence_comparison_test.go:823:   峰值内存 (MB)            | 6.14            | 11.14           | +5.00
    memory_persistence_comparison_test.go:826:   最终内存 (MB)            | 5.30            | 6.61            | +1.32
    memory_persistence_comparison_test.go:829:   内存增量 (MB)            | 1.08            | 2.49            | -
    memory_persistence_comparison_test.go:834: 
        🔗 连接和消费者组统计:
    memory_persistence_comparison_test.go:835:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:836:   -------------------------------------------------------
    memory_persistence_comparison_test.go:837:   连接数                  | 1               | 1              
    memory_persistence_comparison_test.go:839:   消费者组个数               | 1               | 1              
    memory_persistence_comparison_test.go:843: 
        ⚙️  Worker 池统计:
    memory_persistence_comparison_test.go:844:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:845:   -------------------------------------------------------
    memory_persistence_comparison_test.go:846:   使用全局 Worker 池        | true            | true           
    memory_persistence_comparison_test.go:848:   Worker 池大小           | 48              | 48             
    memory_persistence_comparison_test.go:852: 
        🎯 性能总结:
    memory_persistence_comparison_test.go:855:   ✅ Kafka 吞吐量领先 NATS 243.8%
    memory_persistence_comparison_test.go:866:   ✅ NATS 延迟优于 Kafka 306.2%
    memory_persistence_comparison_test.go:871:   ✅ Kafka 内存占用少于 NATS 1.41 MB
    memory_persistence_comparison_test.go:877: ====================================================================================================
    memory_persistence_comparison_test.go:907: 
        ====================================================================================================
    memory_persistence_comparison_test.go:908: 🚀 开始测试场景: Medium 压力 (2000 消息, 5 topics)
    memory_persistence_comparison_test.go:909: ====================================================================================================
    memory_persistence_comparison_test.go:285: 
        ================================================================================
    memory_persistence_comparison_test.go:286: 🔵 测试 Kafka - Medium 压力 (2000 消息, 5 topics)
    memory_persistence_comparison_test.go:287: ================================================================================
    memory_persistence_comparison_test.go:91: 🧹 清理 Kafka 测试数据 (topic prefix: test.memory.kafka)...
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic1
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic3
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic5
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic4
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic2
    memory_persistence_comparison_test.go:125: ✅ 成功删除 5 个 Kafka topics
    memory_persistence_comparison_test.go:171: 🔧 创建 Kafka Topics (3 分区)...
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic1 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic2 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic3 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic4 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic5 (3 partitions)
    memory_persistence_comparison_test.go:212: 📊 验证创建的 Topics:
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:228: ✅ 成功创建 5 个 Kafka topics
    memory_persistence_comparison_test.go:382: 📊 初始资源: Goroutines=321, Memory=6.71 MB
    memory_persistence_comparison_test.go:391: ✅ 已设置预订阅 topic 列表: [test.memory.kafka.topic1 test.memory.kafka.topic2 test.memory.kafka.topic3 test.memory.kafka.topic4 test.memory.kafka.topic5]
    memory_persistence_comparison_test.go:423: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:427: 📤 开始发送 2000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:479: ✅ 发送完成
    memory_persistence_comparison_test.go:482: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:495: ✅ 接收完成: 2000/2000
    memory_persistence_comparison_test.go:370: 📊 Kafka 资源清理完成: 初始 321 -> 最终 455 (泄漏 134)
    memory_persistence_comparison_test.go:516: 
        ================================================================================
    memory_persistence_comparison_test.go:517: 🟢 测试 NATS - Medium 压力 (2000 消息, 5 topics)
    memory_persistence_comparison_test.go:518: ================================================================================
    memory_persistence_comparison_test.go:133: 🧹 清理 NATS 测试数据 (stream prefix: TEST_MEMORY_NATS)...
    memory_persistence_comparison_test.go:156:    ✅ 已删除 stream: TEST_MEMORY_NATS
    memory_persistence_comparison_test.go:163: ✅ 成功删除 1 个 NATS streams
    memory_persistence_comparison_test.go:625: 📊 初始资源: Goroutines=272, Memory=6.42 MB
    memory_persistence_comparison_test.go:657: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:661: 📤 开始发送 2000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:713: ✅ 发送完成
    memory_persistence_comparison_test.go:716: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:729: ✅ 接收完成: 2000/2000
    memory_persistence_comparison_test.go:595: 📊 NATS 资源清理完成: 初始 272 -> 最终 282 (泄漏 10)
    memory_persistence_comparison_test.go:750: 
        ====================================================================================================
    memory_persistence_comparison_test.go:751: 📊 Kafka vs NATS JetStream 内存持久化性能对比报告 - Medium 压力
    memory_persistence_comparison_test.go:752: ====================================================================================================
    memory_persistence_comparison_test.go:755: 
        📋 基本信息:
    memory_persistence_comparison_test.go:756:   压力级别: Medium
    memory_persistence_comparison_test.go:757:   消息总数: 2000
    memory_persistence_comparison_test.go:758:   Topic 数量: 5
    memory_persistence_comparison_test.go:759:   Kafka 分区数: 3 (每个 topic)
    memory_persistence_comparison_test.go:763: 
        📊 Kafka 分区详情:
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:770: 
        📨 消息指标对比:
    memory_persistence_comparison_test.go:771:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:773:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:774:   发送消息数                | 2000            | 2000            | +0.0%
    memory_persistence_comparison_test.go:777:   接收消息数                | 2000            | 2000            | +0.0%
    memory_persistence_comparison_test.go:780:   发送错误数                | 0               | 0               | -
    memory_persistence_comparison_test.go:782:   成功率                  | 100.00         % | 100.00         % | +0.0%
    memory_persistence_comparison_test.go:787: 
        ⚡ 性能指标对比:
    memory_persistence_comparison_test.go:788:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:789:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:790:   发送吞吐量 (msg/s)        | 1922.13         | 175.23          | -90.9%
    memory_persistence_comparison_test.go:793:   接收吞吐量 (msg/s)        | 1922.13         | 175.23          | -90.9%
    memory_persistence_comparison_test.go:796:   平均发送延迟 (ms)          | 0.044           | 25.904          | +58769.1%
    memory_persistence_comparison_test.go:799:   平均处理延迟 (ms)          | 268.560         | 36.066          | -86.6%
    memory_persistence_comparison_test.go:802:   测试时长 (s)             | 1.04            | 11.41           | -
    memory_persistence_comparison_test.go:806: 
        💾 资源占用对比:
    memory_persistence_comparison_test.go:807:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:808:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:809:   初始协程数                | 321             | 272             | -49
    memory_persistence_comparison_test.go:812:   峰值协程数                | 460             | 288             | -172
    memory_persistence_comparison_test.go:815:   最终协程数                | 455             | 282             | -173
    memory_persistence_comparison_test.go:818:   协程泄漏数                | 134             | 10              | -
    memory_persistence_comparison_test.go:820:   初始内存 (MB)            | 6.71            | 6.42            | -0.28
    memory_persistence_comparison_test.go:823:   峰值内存 (MB)            | 9.76            | 16.07           | +6.32
    memory_persistence_comparison_test.go:826:   最终内存 (MB)            | 7.71            | 8.93            | +1.22
    memory_persistence_comparison_test.go:829:   内存增量 (MB)            | 1.00            | 2.50            | -
    memory_persistence_comparison_test.go:834: 
        🔗 连接和消费者组统计:
    memory_persistence_comparison_test.go:835:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:836:   -------------------------------------------------------
    memory_persistence_comparison_test.go:837:   连接数                  | 1               | 1              
    memory_persistence_comparison_test.go:839:   消费者组个数               | 1               | 1              
    memory_persistence_comparison_test.go:843: 
        ⚙️  Worker 池统计:
    memory_persistence_comparison_test.go:844:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:845:   -------------------------------------------------------
    memory_persistence_comparison_test.go:846:   使用全局 Worker 池        | true            | true           
    memory_persistence_comparison_test.go:848:   Worker 池大小           | 48              | 48             
    memory_persistence_comparison_test.go:852: 
        🎯 性能总结:
    memory_persistence_comparison_test.go:855:   ✅ Kafka 吞吐量领先 NATS 996.9%
    memory_persistence_comparison_test.go:866:   ✅ NATS 延迟优于 Kafka 644.6%
    memory_persistence_comparison_test.go:871:   ✅ Kafka 内存占用少于 NATS 1.50 MB
    memory_persistence_comparison_test.go:877: ====================================================================================================
    memory_persistence_comparison_test.go:907: 
        ====================================================================================================
    memory_persistence_comparison_test.go:908: 🚀 开始测试场景: High 压力 (5000 消息, 5 topics)
    memory_persistence_comparison_test.go:909: ====================================================================================================
    memory_persistence_comparison_test.go:285: 
        ================================================================================
    memory_persistence_comparison_test.go:286: 🔵 测试 Kafka - High 压力 (5000 消息, 5 topics)
    memory_persistence_comparison_test.go:287: ================================================================================
    memory_persistence_comparison_test.go:91: 🧹 清理 Kafka 测试数据 (topic prefix: test.memory.kafka)...
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic4
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic2
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic5
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic3
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic1
    memory_persistence_comparison_test.go:125: ✅ 成功删除 5 个 Kafka topics
    memory_persistence_comparison_test.go:171: 🔧 创建 Kafka Topics (3 分区)...
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic1 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic2 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic3 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic4 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic5 (3 partitions)
    memory_persistence_comparison_test.go:212: 📊 验证创建的 Topics:
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:228: ✅ 成功创建 5 个 Kafka topics
    memory_persistence_comparison_test.go:382: 📊 初始资源: Goroutines=328, Memory=8.92 MB
    memory_persistence_comparison_test.go:391: ✅ 已设置预订阅 topic 列表: [test.memory.kafka.topic1 test.memory.kafka.topic2 test.memory.kafka.topic3 test.memory.kafka.topic4 test.memory.kafka.topic5]
    memory_persistence_comparison_test.go:423: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:427: 📤 开始发送 5000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:479: ✅ 发送完成
    memory_persistence_comparison_test.go:482: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:495: ✅ 接收完成: 5000/5000
    memory_persistence_comparison_test.go:370: 📊 Kafka 资源清理完成: 初始 328 -> 最终 462 (泄漏 134)
    memory_persistence_comparison_test.go:516: 
        ================================================================================
    memory_persistence_comparison_test.go:517: 🟢 测试 NATS - High 压力 (5000 消息, 5 topics)
    memory_persistence_comparison_test.go:518: ================================================================================
    memory_persistence_comparison_test.go:133: 🧹 清理 NATS 测试数据 (stream prefix: TEST_MEMORY_NATS)...
    memory_persistence_comparison_test.go:156:    ✅ 已删除 stream: TEST_MEMORY_NATS
    memory_persistence_comparison_test.go:163: ✅ 成功删除 1 个 NATS streams
    memory_persistence_comparison_test.go:625: 📊 初始资源: Goroutines=279, Memory=8.64 MB
    memory_persistence_comparison_test.go:657: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:661: 📤 开始发送 5000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:713: ✅ 发送完成
    memory_persistence_comparison_test.go:716: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:729: ✅ 接收完成: 5000/5000
    memory_persistence_comparison_test.go:595: 📊 NATS 资源清理完成: 初始 279 -> 最终 289 (泄漏 10)
    memory_persistence_comparison_test.go:750: 
        ====================================================================================================
    memory_persistence_comparison_test.go:751: 📊 Kafka vs NATS JetStream 内存持久化性能对比报告 - High 压力
    memory_persistence_comparison_test.go:752: ====================================================================================================
    memory_persistence_comparison_test.go:755: 
        📋 基本信息:
    memory_persistence_comparison_test.go:756:   压力级别: High
    memory_persistence_comparison_test.go:757:   消息总数: 5000
    memory_persistence_comparison_test.go:758:   Topic 数量: 5
    memory_persistence_comparison_test.go:759:   Kafka 分区数: 3 (每个 topic)
    memory_persistence_comparison_test.go:763: 
        📊 Kafka 分区详情:
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:770: 
        📨 消息指标对比:
    memory_persistence_comparison_test.go:771:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:773:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:774:   发送消息数                | 5000            | 5000            | +0.0%
    memory_persistence_comparison_test.go:777:   接收消息数                | 5000            | 5000            | +0.0%
    memory_persistence_comparison_test.go:780:   发送错误数                | 0               | 0               | -
    memory_persistence_comparison_test.go:782:   成功率                  | 100.00         % | 100.00         % | +0.0%
    memory_persistence_comparison_test.go:787: 
        ⚡ 性能指标对比:
    memory_persistence_comparison_test.go:788:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:789:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:790:   发送吞吐量 (msg/s)        | 4547.64         | 1056.25         | -76.8%
    memory_persistence_comparison_test.go:793:   接收吞吐量 (msg/s)        | 4547.64         | 1056.25         | -76.8%
    memory_persistence_comparison_test.go:796:   平均发送延迟 (ms)          | 0.038           | 3.658           | +9618.7%
    memory_persistence_comparison_test.go:799:   平均处理延迟 (ms)          | 339.545         | 4.872           | -98.6%
    memory_persistence_comparison_test.go:802:   测试时长 (s)             | 1.10            | 4.73            | -
    memory_persistence_comparison_test.go:806: 
        💾 资源占用对比:
    memory_persistence_comparison_test.go:807:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:808:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:809:   初始协程数                | 328             | 279             | -49
    memory_persistence_comparison_test.go:812:   峰值协程数                | 467             | 297             | -170
    memory_persistence_comparison_test.go:815:   最终协程数                | 462             | 289             | -173
    memory_persistence_comparison_test.go:818:   协程泄漏数                | 134             | 10              | -
    memory_persistence_comparison_test.go:820:   初始内存 (MB)            | 8.92            | 8.64            | -0.28
    memory_persistence_comparison_test.go:823:   峰值内存 (MB)            | 14.64           | 20.07           | +5.43
    memory_persistence_comparison_test.go:826:   最终内存 (MB)            | 9.89            | 11.13           | +1.24
    memory_persistence_comparison_test.go:829:   内存增量 (MB)            | 0.98            | 2.49            | -
    memory_persistence_comparison_test.go:834: 
        🔗 连接和消费者组统计:
    memory_persistence_comparison_test.go:835:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:836:   -------------------------------------------------------
    memory_persistence_comparison_test.go:837:   连接数                  | 1               | 1              
    memory_persistence_comparison_test.go:839:   消费者组个数               | 1               | 1              
    memory_persistence_comparison_test.go:843: 
        ⚙️  Worker 池统计:
    memory_persistence_comparison_test.go:844:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:845:   -------------------------------------------------------
    memory_persistence_comparison_test.go:846:   使用全局 Worker 池        | true            | true           
    memory_persistence_comparison_test.go:848:   Worker 池大小           | 48              | 48             
    memory_persistence_comparison_test.go:852: 
        🎯 性能总结:
    memory_persistence_comparison_test.go:855:   ✅ Kafka 吞吐量领先 NATS 330.5%
    memory_persistence_comparison_test.go:866:   ✅ NATS 延迟优于 Kafka 6869.2%
    memory_persistence_comparison_test.go:871:   ✅ Kafka 内存占用少于 NATS 1.52 MB
    memory_persistence_comparison_test.go:877: ====================================================================================================
    memory_persistence_comparison_test.go:907: 
        ====================================================================================================
    memory_persistence_comparison_test.go:908: 🚀 开始测试场景: Extreme 压力 (10000 消息, 5 topics)
    memory_persistence_comparison_test.go:909: ====================================================================================================
    memory_persistence_comparison_test.go:285: 
        ================================================================================
    memory_persistence_comparison_test.go:286: 🔵 测试 Kafka - Extreme 压力 (10000 消息, 5 topics)
    memory_persistence_comparison_test.go:287: ================================================================================
    memory_persistence_comparison_test.go:91: 🧹 清理 Kafka 测试数据 (topic prefix: test.memory.kafka)...
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic5
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic4
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic2
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic1
    memory_persistence_comparison_test.go:122:    ✅ 已删除 topic: test.memory.kafka.topic3
    memory_persistence_comparison_test.go:125: ✅ 成功删除 5 个 Kafka topics
    memory_persistence_comparison_test.go:171: 🔧 创建 Kafka Topics (3 分区)...
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic1 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic2 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic3 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic4 (3 partitions)
    memory_persistence_comparison_test.go:205:    ✅ 创建成功: test.memory.kafka.topic5 (3 partitions)
    memory_persistence_comparison_test.go:212: 📊 验证创建的 Topics:
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:222:    test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:228: ✅ 成功创建 5 个 Kafka topics
    memory_persistence_comparison_test.go:382: 📊 初始资源: Goroutines=335, Memory=11.13 MB
    memory_persistence_comparison_test.go:391: ✅ 已设置预订阅 topic 列表: [test.memory.kafka.topic1 test.memory.kafka.topic2 test.memory.kafka.topic3 test.memory.kafka.topic4 test.memory.kafka.topic5]
    memory_persistence_comparison_test.go:423: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:427: 📤 开始发送 10000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:479: ✅ 发送完成
    memory_persistence_comparison_test.go:482: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:495: ✅ 接收完成: 10000/10000
    memory_persistence_comparison_test.go:370: 📊 Kafka 资源清理完成: 初始 335 -> 最终 469 (泄漏 134)
    memory_persistence_comparison_test.go:516: 
        ================================================================================
    memory_persistence_comparison_test.go:517: 🟢 测试 NATS - Extreme 压力 (10000 消息, 5 topics)
    memory_persistence_comparison_test.go:518: ================================================================================
    memory_persistence_comparison_test.go:133: 🧹 清理 NATS 测试数据 (stream prefix: TEST_MEMORY_NATS)...
    memory_persistence_comparison_test.go:156:    ✅ 已删除 stream: TEST_MEMORY_NATS
    memory_persistence_comparison_test.go:163: ✅ 成功删除 1 个 NATS streams
    memory_persistence_comparison_test.go:625: 📊 初始资源: Goroutines=286, Memory=10.87 MB
    memory_persistence_comparison_test.go:657: ⏳ 等待订阅就绪...
    memory_persistence_comparison_test.go:661: 📤 开始发送 10000 条消息到 5 个 topics...
    memory_persistence_comparison_test.go:713: ✅ 发送完成
    memory_persistence_comparison_test.go:716: ⏳ 等待接收完成...
    memory_persistence_comparison_test.go:729: ✅ 接收完成: 10000/10000
    memory_persistence_comparison_test.go:595: 📊 NATS 资源清理完成: 初始 286 -> 最终 296 (泄漏 10)
    memory_persistence_comparison_test.go:750: 
        ====================================================================================================
    memory_persistence_comparison_test.go:751: 📊 Kafka vs NATS JetStream 内存持久化性能对比报告 - Extreme 压力
    memory_persistence_comparison_test.go:752: ====================================================================================================
    memory_persistence_comparison_test.go:755: 
        📋 基本信息:
    memory_persistence_comparison_test.go:756:   压力级别: Extreme
    memory_persistence_comparison_test.go:757:   消息总数: 10000
    memory_persistence_comparison_test.go:758:   Topic 数量: 5
    memory_persistence_comparison_test.go:759:   Kafka 分区数: 3 (每个 topic)
    memory_persistence_comparison_test.go:763: 
        📊 Kafka 分区详情:
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic1: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic2: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic3: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic4: 3 partitions
    memory_persistence_comparison_test.go:765:   test.memory.kafka.topic5: 3 partitions
    memory_persistence_comparison_test.go:770: 
        📨 消息指标对比:
    memory_persistence_comparison_test.go:771:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:773:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:774:   发送消息数                | 10000           | 10000           | +0.0%
    memory_persistence_comparison_test.go:777:   接收消息数                | 10000           | 10000           | +0.0%
    memory_persistence_comparison_test.go:780:   发送错误数                | 0               | 0               | -
    memory_persistence_comparison_test.go:782:   成功率                  | 100.00         % | 100.00         % | +0.0%
    memory_persistence_comparison_test.go:787: 
        ⚡ 性能指标对比:
    memory_persistence_comparison_test.go:788:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:789:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:790:   发送吞吐量 (msg/s)        | 7742.15         | 175.79          | -97.7%
    memory_persistence_comparison_test.go:793:   接收吞吐量 (msg/s)        | 7742.15         | 175.79          | -97.7%
    memory_persistence_comparison_test.go:796:   平均发送延迟 (ms)          | 0.051           | 27.751          | +54002.7%
    memory_persistence_comparison_test.go:799:   平均处理延迟 (ms)          | 187.919         | 38.358          | -79.6%
    memory_persistence_comparison_test.go:802:   测试时长 (s)             | 1.29            | 56.88           | -
    memory_persistence_comparison_test.go:806: 
        💾 资源占用对比:
    memory_persistence_comparison_test.go:807:   指标                   | Kafka           | NATS            | 差异             
    memory_persistence_comparison_test.go:808:   ----------------------------------------------------------------------
    memory_persistence_comparison_test.go:809:   初始协程数                | 335             | 286             | -49
    memory_persistence_comparison_test.go:812:   峰值协程数                | 474             | 304             | -170
    memory_persistence_comparison_test.go:815:   最终协程数                | 469             | 296             | -173
    memory_persistence_comparison_test.go:818:   协程泄漏数                | 134             | 10              | -
    memory_persistence_comparison_test.go:820:   初始内存 (MB)            | 11.13           | 10.87           | -0.26
    memory_persistence_comparison_test.go:823:   峰值内存 (MB)            | 19.08           | 24.01           | +4.93
    memory_persistence_comparison_test.go:826:   最终内存 (MB)            | 12.11           | 13.35           | +1.24
    memory_persistence_comparison_test.go:829:   内存增量 (MB)            | 0.98            | 2.48            | -
    memory_persistence_comparison_test.go:834: 
        🔗 连接和消费者组统计:
    memory_persistence_comparison_test.go:835:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:836:   -------------------------------------------------------
    memory_persistence_comparison_test.go:837:   连接数                  | 1               | 1              
    memory_persistence_comparison_test.go:839:   消费者组个数               | 1               | 1              
    memory_persistence_comparison_test.go:843: 
        ⚙️  Worker 池统计:
    memory_persistence_comparison_test.go:844:   指标                   | Kafka           | NATS           
    memory_persistence_comparison_test.go:845:   -------------------------------------------------------
    memory_persistence_comparison_test.go:846:   使用全局 Worker 池        | true            | true           
    memory_persistence_comparison_test.go:848:   Worker 池大小           | 48              | 48             
    memory_persistence_comparison_test.go:852: 
        🎯 性能总结:
    memory_persistence_comparison_test.go:855:   ✅ Kafka 吞吐量领先 NATS 4304.1%
    memory_persistence_comparison_test.go:866:   ✅ NATS 延迟优于 Kafka 389.9%
    memory_persistence_comparison_test.go:871:   ✅ Kafka 内存占用少于 NATS 1.50 MB
    memory_persistence_comparison_test.go:877: ====================================================================================================
    memory_persistence_comparison_test.go:933: 
        ====================================================================================================
    memory_persistence_comparison_test.go:934: 📊 所有场景汇总报告
    memory_persistence_comparison_test.go:935: ====================================================================================================
    memory_persistence_comparison_test.go:937: 
        场景         | 系统              | 吞吐量(msg/s)      | 延迟(ms)          | 成功率(%)          | 内存增量(MB)       
    memory_persistence_comparison_test.go:940: ----------------------------------------------------------------------------------------------------
    memory_persistence_comparison_test.go:944: Low        | Kafka           | 493.45          | 136.811         | 100.00          | 1.08           
    memory_persistence_comparison_test.go:950:            | NATS            | 143.53          | 33.678          | 100.00          | 2.49           
    memory_persistence_comparison_test.go:956: ----------------------------------------------------------------------------------------------------
    memory_persistence_comparison_test.go:944: Medium     | Kafka           | 1922.13         | 268.560         | 100.00          | 1.00           
    memory_persistence_comparison_test.go:950:            | NATS            | 175.23          | 36.066          | 100.00          | 2.50           
    memory_persistence_comparison_test.go:956: ----------------------------------------------------------------------------------------------------
    memory_persistence_comparison_test.go:944: High       | Kafka           | 4547.64         | 339.545         | 100.00          | 0.98           
    memory_persistence_comparison_test.go:950:            | NATS            | 1056.25         | 4.872           | 100.00          | 2.49           
    memory_persistence_comparison_test.go:956: ----------------------------------------------------------------------------------------------------
    memory_persistence_comparison_test.go:944: Extreme    | Kafka           | 7742.15         | 187.919         | 100.00          | 0.98           
    memory_persistence_comparison_test.go:950:            | NATS            | 175.79          | 38.358          | 100.00          | 2.48           
    memory_persistence_comparison_test.go:956: ----------------------------------------------------------------------------------------------------
    memory_persistence_comparison_test.go:960: 
        🔍 关键发现:
    memory_persistence_comparison_test.go:961:   1. ✅ 所有测试使用 Publish/Subscribe 方法（无聚合ID）
    memory_persistence_comparison_test.go:962:   2. ✅ Kafka 和 NATS 都使用内存持久化
    memory_persistence_comparison_test.go:963:   3. ✅ Kafka 使用 3 分区配置
    memory_persistence_comparison_test.go:964:   4. ✅ 两个系统都使用全局 Worker 池处理订阅消息
    memory_persistence_comparison_test.go:965:   5. ✅ Topic 数量: 5
    memory_persistence_comparison_test.go:966:   6. ✅ 测试前已清理 Kafka 和 NATS 数据
    memory_persistence_comparison_test.go:968: 
        ✅ 所有测试完成！
    memory_persistence_comparison_test.go:969: ====================================================================================================
--- PASS: TestMemoryPersistenceComparison (211.71s)
PASS
ok  	github.com/ChenBigdata421/jxt-core/tests/eventbus/performance_tests	211.984s
