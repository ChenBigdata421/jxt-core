# Kafka vs NATS JetStream æ€§èƒ½å¯¹æ¯”æµ‹è¯• - å¿«é€Ÿå…¥é—¨

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: éªŒè¯æµ‹è¯•æ–‡ä»¶

**Linux/Mac:**
```bash
cd sdk/pkg/eventbus/performance_tests
chmod +x verify_test.sh
./verify_test.sh
```

**Windows:**
```cmd
cd sdk\pkg\eventbus\performance_tests
verify_test.bat
```

å¦‚æœçœ‹åˆ° "âœ… æµ‹è¯•æ–‡ä»¶ç¼–è¯‘æˆåŠŸï¼"ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ã€‚

### æ­¥éª¤ 2: å¯åŠ¨æœåŠ¡

ç¡®ä¿ Kafka å’Œ NATS æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
# å¯åŠ¨ Kafka (RedPanda)
docker-compose up -d kafka

# å¯åŠ¨ NATS JetStream
docker-compose up -d nats

# éªŒè¯æœåŠ¡çŠ¶æ€
docker ps | grep -E "kafka|nats"
```

### æ­¥éª¤ 3: è¿è¡Œæµ‹è¯•

**Linux/Mac:**
```bash
chmod +x run_comparison_test.sh
./run_comparison_test.sh
```

**Windows:**
```cmd
run_comparison_test.bat
```

**æˆ–è€…ç›´æ¥è¿è¡Œ:**
```bash
go test -v -run TestKafkaVsNATSPerformanceComparison -timeout 30m
```

### æ­¥éª¤ 4: æŸ¥çœ‹ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

1. **å®æ—¶è¾“å‡º** - æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†çš„æµ‹è¯•è¿›åº¦å’Œç»“æœ
2. **æ—¥å¿—æ–‡ä»¶** - ä¿å­˜åœ¨ `test_results/comparison_test_YYYYMMDD_HHMMSS.log`

## ğŸ“Š é¢„æœŸè¾“å‡ºç¤ºä¾‹

```
================================================================================
ğŸ“Š ä½å‹ æµ‹è¯•ç»“æœå¯¹æ¯”
================================================================================

ğŸ“¨ æ¶ˆæ¯ç»Ÿè®¡:
   å‘é€æ¶ˆæ¯æ•°           | Kafka:      500 | NATS:      500
   æ¥æ”¶æ¶ˆæ¯æ•°           | Kafka:      500 | NATS:      500
   æˆåŠŸç‡               | Kafka:  100.00% | NATS:  100.00%

ğŸš€ æ€§èƒ½æŒ‡æ ‡:
   å‘é€ååé‡           | Kafka:    1234.56 msg/s | NATS:    2345.67 msg/s
   æ¥æ”¶ååé‡           | Kafka:    1234.56 msg/s | NATS:    2345.67 msg/s
   å¹³å‡å‘é€å»¶è¿Ÿ         | Kafka:      0.123 ms | NATS:      0.056 ms
   å¹³å‡å¤„ç†å»¶è¿Ÿ         | Kafka:      0.234 ms | NATS:      0.123 ms

ğŸ’¾ èµ„æºå ç”¨:
   å³°å€¼åç¨‹æ•°           | Kafka:       67 | NATS:       52
   å†…å­˜å¢é‡             | Kafka:      11.11 MB | NATS:       7.11 MB

ğŸ† æ€§èƒ½ä¼˜åŠ¿:
   NATS ååé‡ä¼˜åŠ¿: +90.12%
   NATS å»¶è¿Ÿä¼˜åŠ¿: -47.44%
   NATS å†…å­˜ä¼˜åŠ¿: -36.00%
================================================================================
```

## ğŸ¯ æµ‹è¯•å†…å®¹

### æµ‹è¯•åœºæ™¯
- âœ… **ä½å‹**: 500 æ¡æ¶ˆæ¯ (60ç§’è¶…æ—¶)
- âœ… **ä¸­å‹**: 2000 æ¡æ¶ˆæ¯ (120ç§’è¶…æ—¶)
- âœ… **é«˜å‹**: 5000 æ¡æ¶ˆæ¯ (180ç§’è¶…æ—¶)
- âœ… **æé™**: 10000 æ¡æ¶ˆæ¯ (300ç§’è¶…æ—¶)

### æµ‹è¯•é…ç½®
- âœ… **Kafka**: æŒä¹…åŒ– (RequiredAcks=-1), Snappy å‹ç¼©, å¹‚ç­‰æ€§
- âœ… **NATS**: ç£ç›˜æŒä¹…åŒ– (Storage=file), 1GB å­˜å‚¨é™åˆ¶
- âœ… **å‘å¸ƒ**: ä½¿ç”¨ `PublishEnvelope()` æ–¹æ³•
- âœ… **è®¢é˜…**: ä½¿ç”¨ `SubscribeEnvelope()` æ–¹æ³•

### æµ‹è¯•æŒ‡æ ‡
- ğŸ“Š **æ€§èƒ½**: ååé‡ã€å»¶è¿Ÿã€æˆåŠŸç‡
- ğŸ’¾ **èµ„æº**: åç¨‹æ•°ã€å†…å­˜å ç”¨
- ğŸ”„ **å¯é æ€§**: é¡ºåºæ€§ã€é”™è¯¯ç‡

## â±ï¸ æµ‹è¯•æ—¶é—´

- **å®Œæ•´æµ‹è¯•**: çº¦ 15-20 åˆ†é’Ÿ (4ä¸ªåœºæ™¯)
- **å•åœºæ™¯**: çº¦ 1-5 åˆ†é’Ÿ

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### åªè¿è¡Œä½å‹æµ‹è¯•

ç¼–è¾‘ `kafka_nats_comparison_test.go`ï¼Œä¿®æ”¹ `scenarios`:

```go
scenarios := []struct {
    name     string
    messages int
    timeout  time.Duration
}{
    {"ä½å‹", 500, 60 * time.Second}, // åªä¿ç•™è¿™ä¸€è¡Œ
}
```

### ä¿®æ”¹æ¶ˆæ¯æ•°é‡

```go
scenarios := []struct {
    name     string
    messages int
    timeout  time.Duration
}{
    {"è‡ªå®šä¹‰", 1000, 90 * time.Second},
}
```

## ğŸ“š æ›´å¤šæ–‡æ¡£

- **README.md** - å®Œæ•´çš„ä½¿ç”¨è¯´æ˜
- **EXAMPLE_REPORT.md** - è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹
- **SUMMARY.md** - æµ‹è¯•å¥—ä»¶æ€»ç»“
- **COMPLETION_REPORT.md** - ä»»åŠ¡å®ŒæˆæŠ¥å‘Š

## â“ å¸¸è§é—®é¢˜

### Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤ºè¿æ¥ä¸ä¸Š Kafka
**A:** æ£€æŸ¥ Kafka æ˜¯å¦è¿è¡Œï¼š
```bash
docker ps | grep kafka
netstat -an | grep 29092  # Linux/Mac
netstat -an | findstr 29092  # Windows
```

### Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤ºè¿æ¥ä¸ä¸Š NATS
**A:** æ£€æŸ¥ NATS æ˜¯å¦è¿è¡Œï¼š
```bash
docker ps | grep nats
netstat -an | grep 4223  # Linux/Mac
netstat -an | findstr 4223  # Windows
```

### Q: æµ‹è¯•è¶…æ—¶
**A:** å¯èƒ½åŸå› ï¼š
- ç³»ç»Ÿèµ„æºä¸è¶³
- ç½‘ç»œå»¶è¿Ÿ
- æ¶ˆæ¯æ•°é‡å¤ªå¤š

è§£å†³æ–¹æ¡ˆï¼š
- å¢åŠ  timeout å‚æ•°
- å‡å°‘æ¶ˆæ¯æ•°é‡
- å…³é—­å…¶ä»–åº”ç”¨é‡Šæ”¾èµ„æº

### Q: å¦‚ä½•åªæµ‹è¯• Kafka æˆ– NATSï¼Ÿ
**A:** æ³¨é‡Šæ‰ä¸éœ€è¦çš„æµ‹è¯•ï¼š
```go
// åªæµ‹è¯• Kafka
kafkaMetrics := runKafkaTest(t, scenario.name, scenario.messages, scenario.timeout)
// natsMetrics := runNATSTest(t, scenario.name, scenario.messages, scenario.timeout)
```

### Q: å¦‚ä½•ä¿å­˜æµ‹è¯•ç»“æœï¼Ÿ
**A:** æµ‹è¯•ç»“æœä¼šè‡ªåŠ¨ä¿å­˜åˆ° `test_results/` ç›®å½•ï¼Œæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ã€‚

## ğŸ‰ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹ç»“æœ
2. ğŸ“Š åˆ†ææ€§èƒ½æ•°æ®
3. ğŸ’¡ æ ¹æ®ç»“æœåšæŠ€æœ¯é€‰å‹
4. ğŸ”§ æ ¹æ®éœ€æ±‚è°ƒæ•´é…ç½®

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ **README.md** çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æµ‹è¯•æ—¥å¿—æ–‡ä»¶
3. æŸ¥çœ‹ **EXAMPLE_REPORT.md** äº†è§£é¢„æœŸè¾“å‡º
4. é˜…è¯» **SUMMARY.md** äº†è§£æµ‹è¯•è¯¦æƒ…

---

*å¿«é€Ÿå…¥é—¨æŒ‡å—*  
*ç‰ˆæœ¬: 1.0.0*  
*æ›´æ–°æ—¥æœŸ: 2025-10-12*

